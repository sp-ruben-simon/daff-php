<?php
/**
 * Generated by Haxe 4.0.0 (git build development @ 3988422)
 */

namespace coopy;

use \haxe\ds\StringMap;
use \php\Boot;
use \php\_NativeArray\NativeArrayIterator;
use \haxe\ds\IntMap;

class CompareTable {
	/**
	 * @var TableComparisonState
	 */
	public $comp;
	/**
	 * @var \Array_hx
	 */
	public $indexes;


	/**
	 * @param TableComparisonState $comp
	 * 
	 * @return void
	 */
	public function __construct ($comp) {
		#coopy/CompareTable.hx:25: characters 9-25
		$this->comp = $comp;
		#coopy/CompareTable.hx:26: lines 26-30
		if ($comp->compare_flags !== null) {
			#coopy/CompareTable.hx:27: lines 27-29
			if ($comp->compare_flags->parent !== null) {
				#coopy/CompareTable.hx:28: characters 17-51
				$comp->p = $comp->compare_flags->parent;
			}
		}
	}


	/**
	 * @return Alignment
	 */
	public function align () {
		#coopy/CompareTable.hx:62: lines 62-64
		while (!$this->comp->completed) {
			#coopy/CompareTable.hx:63: characters 13-18
			$this->run();
		}
		#coopy/CompareTable.hx:65: characters 9-53
		$alignment = new Alignment();
		#coopy/CompareTable.hx:66: characters 9-29
		$this->alignCore($alignment);
		#coopy/CompareTable.hx:68: characters 9-30
		$alignment->comp = $this->comp;
		#coopy/CompareTable.hx:69: characters 9-35
		$this->comp->alignment = $alignment;
		#coopy/CompareTable.hx:70: characters 9-25
		return $alignment;
	}


	/**
	 * @param Alignment $align
	 * @param Table $a
	 * @param Table $b
	 * 
	 * @return void
	 */
	public function alignColumns ($align, $a, $b) {
		#coopy/CompareTable.hx:409: characters 9-37
		$align->range($a->get_width(), $b->get_width());
		#coopy/CompareTable.hx:410: characters 9-26
		$align->tables($a, $b);
		#coopy/CompareTable.hx:411: characters 9-32
		$align->setRowlike(false);
		#coopy/CompareTable.hx:413: characters 9-28
		$slop = 5;
		#coopy/CompareTable.hx:415: characters 9-41
		$va = $a->getCellView();
		#coopy/CompareTable.hx:416: characters 9-41
		$vb = $b->getCellView();
		#coopy/CompareTable.hx:417: characters 9-31
		$ra_best = 0;
		#coopy/CompareTable.hx:418: characters 9-31
		$rb_best = 0;
		#coopy/CompareTable.hx:419: characters 9-32
		$ct_best = -1;
		#coopy/CompareTable.hx:420: characters 9-46
		$ma_best = null;
		#coopy/CompareTable.hx:421: characters 9-46
		$mb_best = null;
		#coopy/CompareTable.hx:422: characters 9-33
		$ra_header = 0;
		#coopy/CompareTable.hx:423: characters 9-33
		$rb_header = 0;
		#coopy/CompareTable.hx:424: characters 9-34
		$ra_uniques = 0;
		#coopy/CompareTable.hx:425: characters 9-34
		$rb_uniques = 0;
		#coopy/CompareTable.hx:426: lines 426-484
		$_g1 = 0;
		#coopy/CompareTable.hx:426: lines 426-484
		$_g = $slop;
		#coopy/CompareTable.hx:426: lines 426-484
		while ($_g1 < $_g) {
			#coopy/CompareTable.hx:426: lines 426-484
			$_g1 = $_g1 + 1;
			#coopy/CompareTable.hx:426: characters 14-16
			$ra = $_g1 - 1;
			#coopy/CompareTable.hx:427: lines 427-483
			$_g3 = 0;
			#coopy/CompareTable.hx:427: lines 427-483
			$_g2 = $slop;
			#coopy/CompareTable.hx:427: lines 427-483
			while ($_g3 < $_g2) {
				#coopy/CompareTable.hx:427: lines 427-483
				$_g3 = $_g3 + 1;
				#coopy/CompareTable.hx:427: characters 18-20
				$rb = $_g3 - 1;
				#coopy/CompareTable.hx:428: characters 17-66
				$ma = new StringMap();
				#coopy/CompareTable.hx:429: characters 17-66
				$mb = new StringMap();
				#coopy/CompareTable.hx:430: characters 17-34
				$ct = 0;
				#coopy/CompareTable.hx:431: characters 17-39
				$uniques = 0;
				#coopy/CompareTable.hx:432: lines 432-447
				if ($ra < $a->get_height()) {
					#coopy/CompareTable.hx:433: lines 433-442
					$_g5 = 0;
					#coopy/CompareTable.hx:433: lines 433-442
					$_g4 = $a->get_width();
					#coopy/CompareTable.hx:433: lines 433-442
					while ($_g5 < $_g4) {
						#coopy/CompareTable.hx:433: lines 433-442
						$_g5 = $_g5 + 1;
						#coopy/CompareTable.hx:433: characters 26-28
						$ca = $_g5 - 1;
						#coopy/CompareTable.hx:434: characters 25-74
						$key = $va->toString($a->getCell($ca, $ra));
						#coopy/CompareTable.hx:435: lines 435-441
						if (array_key_exists($key, $ma->data)) {
							#coopy/CompareTable.hx:436: characters 29-43
							$ma->data[$key] = -1;
							#coopy/CompareTable.hx:437: characters 29-38
							$uniques = $uniques - 1;
						} else {
							#coopy/CompareTable.hx:439: characters 25-39
							$ma->data[$key] = $ca;
							#coopy/CompareTable.hx:440: characters 25-34
							$uniques = $uniques + 1;
						}
					}

					#coopy/CompareTable.hx:443: lines 443-446
					if ($uniques > $ra_uniques) {
						#coopy/CompareTable.hx:444: characters 25-39
						$ra_header = $ra;
						#coopy/CompareTable.hx:445: characters 25-45
						$ra_uniques = $uniques;
					}
				}
				#coopy/CompareTable.hx:448: characters 17-28
				$uniques = 0;
				#coopy/CompareTable.hx:449: lines 449-464
				if ($rb < $b->get_height()) {
					#coopy/CompareTable.hx:450: lines 450-459
					$_g51 = 0;
					#coopy/CompareTable.hx:450: lines 450-459
					$_g41 = $b->get_width();
					#coopy/CompareTable.hx:450: lines 450-459
					while ($_g51 < $_g41) {
						#coopy/CompareTable.hx:450: lines 450-459
						$_g51 = $_g51 + 1;
						#coopy/CompareTable.hx:450: characters 26-28
						$cb = $_g51 - 1;
						#coopy/CompareTable.hx:451: characters 25-74
						$key1 = $vb->toString($b->getCell($cb, $rb));
						#coopy/CompareTable.hx:452: lines 452-458
						if (array_key_exists($key1, $mb->data)) {
							#coopy/CompareTable.hx:453: characters 29-43
							$mb->data[$key1] = -1;
							#coopy/CompareTable.hx:454: characters 29-38
							$uniques = $uniques - 1;
						} else {
							#coopy/CompareTable.hx:456: characters 29-43
							$mb->data[$key1] = $cb;
							#coopy/CompareTable.hx:457: characters 29-38
							$uniques = $uniques + 1;
						}
					}

					#coopy/CompareTable.hx:460: lines 460-463
					if ($uniques > $rb_uniques) {
						#coopy/CompareTable.hx:461: characters 25-39
						$rb_header = $rb;
						#coopy/CompareTable.hx:462: characters 25-45
						$rb_uniques = $uniques;
					}
				}
				#coopy/CompareTable.hx:466: characters 29-38
				$key2 = new NativeArrayIterator(array_map("strval", array_keys($ma->data)));
				#coopy/CompareTable.hx:466: characters 29-38
				while ($key2->hasNext()) {
					#coopy/CompareTable.hx:466: lines 466-474
					$key3 = $key2->next();
					#coopy/CompareTable.hx:467: characters 21-48
					$i0 = ($ma->data[$key3] ?? null);
					#coopy/CompareTable.hx:468: characters 21-54
					$i1 = ($mb->data[$key3] ?? null);
					#coopy/CompareTable.hx:469: lines 469-473
					if ($i1 !== null) {
						#coopy/CompareTable.hx:470: lines 470-472
						if (($i1 >= 0) && ($i0 >= 0)) {
							#coopy/CompareTable.hx:471: characters 29-33
							$ct = $ct + 1;
						}
					}
				}

				#coopy/CompareTable.hx:476: lines 476-482
				if ($ct > $ct_best) {
					#coopy/CompareTable.hx:477: characters 21-33
					$ct_best = $ct;
					#coopy/CompareTable.hx:478: characters 21-33
					$ma_best = $ma;
					#coopy/CompareTable.hx:479: characters 21-33
					$mb_best = $mb;
					#coopy/CompareTable.hx:480: characters 21-33
					$ra_best = $ra;
					#coopy/CompareTable.hx:481: characters 21-33
					$rb_best = $rb;
				}
			}

		}

		#coopy/CompareTable.hx:486: lines 486-493
		if ($ma_best === null) {
			#coopy/CompareTable.hx:487: lines 487-491
			if (($a->get_height() > 0) && ($b->get_height() === 0)) {
				#coopy/CompareTable.hx:488: characters 17-36
				$align->headers(0, -1);
			} else if (($a->get_height() === 0) && ($b->get_height() > 0)) {
				#coopy/CompareTable.hx:490: characters 17-36
				$align->headers(-1, 0);
			}
			#coopy/CompareTable.hx:492: characters 13-19
			return;
		}
		#coopy/CompareTable.hx:494: characters 21-35
		$key4 = new NativeArrayIterator(array_map("strval", array_keys($ma_best->data)));
		#coopy/CompareTable.hx:494: characters 21-35
		while ($key4->hasNext()) {
			#coopy/CompareTable.hx:494: lines 494-504
			$key5 = $key4->next();
			#coopy/CompareTable.hx:495: characters 13-51
			$i01 = ($ma_best->data[$key5] ?? null);
			#coopy/CompareTable.hx:496: characters 13-51
			$i11 = ($mb_best->data[$key5] ?? null);
			#coopy/CompareTable.hx:497: lines 497-503
			if (($i01 !== null) && ($i11 !== null)) {
				#coopy/CompareTable.hx:498: characters 17-34
				$align->link($i01, $i11);
			} else if ($i01 !== null) {
				#coopy/CompareTable.hx:500: characters 17-34
				$align->link($i01, -1);
			} else if ($i11 !== null) {
				#coopy/CompareTable.hx:502: characters 17-34
				$align->link(-1, $i11);
			}
		}

		#coopy/CompareTable.hx:505: characters 21-35
		$key6 = new NativeArrayIterator(array_map("strval", array_keys($mb_best->data)));
		#coopy/CompareTable.hx:505: characters 21-35
		while ($key6->hasNext()) {
			#coopy/CompareTable.hx:505: lines 505-511
			$key7 = $key6->next();
			#coopy/CompareTable.hx:506: characters 13-51
			$i02 = ($ma_best->data[$key7] ?? null);
			#coopy/CompareTable.hx:507: characters 13-51
			$i12 = ($mb_best->data[$key7] ?? null);
			#coopy/CompareTable.hx:508: lines 508-510
			if (($i02 === null) && ($i12 !== null)) {
				#coopy/CompareTable.hx:509: characters 17-34
				$align->link(-1, $i12);
			}
		}

		#coopy/CompareTable.hx:512: characters 9-43
		$align->headers($ra_header, $rb_header);
	}


	/**
	 * @param Alignment $align
	 * 
	 * @return void
	 */
	public function alignCore ($align) {
		#coopy/CompareTable.hx:84: lines 84-107
		if ($this->useSql()) {
			#coopy/CompareTable.hx:85: characters 13-40
			$tab1 = null;
			#coopy/CompareTable.hx:86: characters 13-40
			$tab2 = null;
			#coopy/CompareTable.hx:87: characters 13-40
			$tab3 = null;
			#coopy/CompareTable.hx:88: lines 88-96
			if ($this->comp->p === null) {
				#coopy/CompareTable.hx:89: characters 17-35
				$tab1 = $this->comp->a;
				#coopy/CompareTable.hx:90: characters 17-35
				$tab2 = $this->comp->b;
			} else {
				#coopy/CompareTable.hx:92: characters 17-50
				$align->reference = new Alignment();
				#coopy/CompareTable.hx:93: characters 17-35
				$tab1 = $this->comp->p;
				#coopy/CompareTable.hx:94: characters 17-35
				$tab2 = $this->comp->b;
				#coopy/CompareTable.hx:95: characters 17-35
				$tab3 = $this->comp->a;
			}
			#coopy/CompareTable.hx:97: characters 13-41
			$db = null;
			#coopy/CompareTable.hx:98: characters 13-52
			if ($tab1 !== null) {
				#coopy/CompareTable.hx:98: characters 29-52
				$db = $tab1->getDatabase();
			}
			#coopy/CompareTable.hx:99: characters 13-64
			if (($db === null) && ($tab2 !== null)) {
				#coopy/CompareTable.hx:99: characters 41-64
				$db = $tab2->getDatabase();
			}
			#coopy/CompareTable.hx:100: characters 13-64
			if (($db === null) && ($tab3 !== null)) {
				#coopy/CompareTable.hx:100: characters 41-64
				$db = $tab3->getDatabase();
			}
			#coopy/CompareTable.hx:101: characters 13-62
			$sc = new SqlCompare($db, $tab1, $tab2, $tab3, $align);
			#coopy/CompareTable.hx:102: characters 13-23
			$sc->apply();
			#coopy/CompareTable.hx:103: lines 103-105
			if ($this->comp->p !== null) {
				#coopy/CompareTable.hx:104: characters 17-60
				$align->meta->reference = $align->reference->meta;
			}
			#coopy/CompareTable.hx:106: characters 13-19
			return;
		}
		#coopy/CompareTable.hx:108: lines 108-111
		if ($this->comp->p === null) {
			#coopy/CompareTable.hx:109: characters 13-44
			$this->alignCore2($align, $this->comp->a, $this->comp->b);
			#coopy/CompareTable.hx:110: characters 13-19
			return;
		}
		#coopy/CompareTable.hx:112: characters 9-42
		$align->reference = new Alignment();
		#coopy/CompareTable.hx:113: characters 9-40
		$this->alignCore2($align, $this->comp->p, $this->comp->b);
		#coopy/CompareTable.hx:114: characters 9-50
		$this->alignCore2($align->reference, $this->comp->p, $this->comp->a);
		#coopy/CompareTable.hx:115: characters 9-52
		$align->meta->reference = $align->reference->meta;
	}


	/**
	 * @param Alignment $align
	 * @param Table $a
	 * @param Table $b
	 * 
	 * @return void
	 */
	public function alignCore2 ($align, $a, $b) {
		#coopy/CompareTable.hx:121: lines 121-123
		if ($align->meta === null) {
			#coopy/CompareTable.hx:122: characters 13-23
			$align->meta = new Alignment();
		}
		#coopy/CompareTable.hx:124: characters 9-37
		$this->alignColumns($align->meta, $a, $b);
		#coopy/CompareTable.hx:125: characters 9-60
		$column_order = $align->meta->toOrder();
		#coopy/CompareTable.hx:127: characters 9-39
		$align->range($a->get_height(), $b->get_height());
		#coopy/CompareTable.hx:128: characters 9-26
		$align->tables($a, $b);
		#coopy/CompareTable.hx:129: characters 9-31
		$align->setRowlike(true);
		#coopy/CompareTable.hx:131: characters 9-31
		$w = $a->get_width();
		#coopy/CompareTable.hx:132: characters 9-33
		$ha = $a->get_height();
		#coopy/CompareTable.hx:133: characters 9-33
		$hb = $b->get_height();
		#coopy/CompareTable.hx:135: characters 9-41
		$av = $a->getCellView();
		#coopy/CompareTable.hx:137: characters 9-40
		$ids = null;
		#coopy/CompareTable.hx:138: characters 9-46
		$ignore = null;
		#coopy/CompareTable.hx:139: lines 139-142
		if ($this->comp->compare_flags !== null) {
			#coopy/CompareTable.hx:140: characters 13-16
			$ids = $this->comp->compare_flags->ids;
			#coopy/CompareTable.hx:141: characters 13-19
			$ignore = $this->comp->compare_flags->getIgnoredColumns();
		}
		#coopy/CompareTable.hx:144: characters 9-60
		$common_units = new \Array_hx();
		#coopy/CompareTable.hx:145: characters 9-55
		$ra_header = $align->getSourceHeader();
		#coopy/CompareTable.hx:146: characters 9-55
		$rb_header = $align->getSourceHeader();
		#coopy/CompareTable.hx:147: lines 147-161
		$_g = 0;
		#coopy/CompareTable.hx:147: lines 147-161
		$_g1 = $column_order->getList();
		#coopy/CompareTable.hx:147: lines 147-161
		while ($_g < $_g1->length) {
			#coopy/CompareTable.hx:147: characters 14-18
			$unit = ($_g1->arr[$_g] ?? null);
			#coopy/CompareTable.hx:147: lines 147-161
			$_g = $_g + 1;
			#coopy/CompareTable.hx:148: lines 148-160
			if (($unit->l >= 0) && ($unit->r >= 0) && ($unit->p !== -1)) {
				#coopy/CompareTable.hx:149: lines 149-158
				if ($ignore !== null) {
					#coopy/CompareTable.hx:150: lines 150-153
					if (($unit->l >= 0) && ($ra_header >= 0) && ($ra_header < $a->get_height())) {
						#coopy/CompareTable.hx:151: characters 25-77
						$name = $av->toString($a->getCell($unit->l, $ra_header));
						#coopy/CompareTable.hx:152: characters 25-58
						if (array_key_exists($name, $ignore->data)) {
							#coopy/CompareTable.hx:152: characters 50-58
							continue;
						}
					}
					#coopy/CompareTable.hx:154: lines 154-157
					if (($unit->r >= 0) && ($rb_header >= 0) && ($rb_header < $b->get_height())) {
						#coopy/CompareTable.hx:155: characters 25-77
						$name1 = $av->toString($b->getCell($unit->r, $rb_header));
						#coopy/CompareTable.hx:156: characters 25-58
						if (array_key_exists($name1, $ignore->data)) {
							#coopy/CompareTable.hx:156: characters 50-58
							continue;
						}
					}
				}
				#coopy/CompareTable.hx:159: characters 17-40
				$common_units->arr[$common_units->length] = $unit;
				#coopy/CompareTable.hx:159: characters 17-40
				++$common_units->length;

			}
		}

		#coopy/CompareTable.hx:163: characters 9-42
		$index_top = null;
		#coopy/CompareTable.hx:164: characters 9-35
		$pending_ct = $ha;
		#coopy/CompareTable.hx:165: characters 9-43
		$reverse_pending_ct = $hb;
		#coopy/CompareTable.hx:166: characters 9-54
		$used = new IntMap();
		#coopy/CompareTable.hx:167: characters 9-62
		$used_reverse = new IntMap();
		#coopy/CompareTable.hx:168: lines 168-322
		if ($ids !== null) {
			#coopy/CompareTable.hx:172: characters 13-22
			$index_top = new IndexPair($this->comp->compare_flags);
			#coopy/CompareTable.hx:173: characters 30-52
			$this1 = [];
			#coopy/CompareTable.hx:173: characters 30-52
			$ids_as_map_data = $this1;
			#coopy/CompareTable.hx:174: lines 174-176
			$_g2 = 0;
			#coopy/CompareTable.hx:174: lines 174-176
			while ($_g2 < $ids->length) {
				#coopy/CompareTable.hx:174: characters 18-20
				$id = ($ids->arr[$_g2] ?? null);
				#coopy/CompareTable.hx:174: lines 174-176
				$_g2 = $_g2 + 1;
				#coopy/CompareTable.hx:175: characters 17-38
				$ids_as_map_data[$id] = true;
			}

			#coopy/CompareTable.hx:177: lines 177-184
			$_g3 = 0;
			#coopy/CompareTable.hx:177: lines 177-184
			while ($_g3 < $common_units->length) {
				#coopy/CompareTable.hx:177: characters 18-22
				$unit1 = ($common_units->arr[$_g3] ?? null);
				#coopy/CompareTable.hx:177: lines 177-184
				$_g3 = $_g3 + 1;
				#coopy/CompareTable.hx:178: characters 17-59
				$na = $av->toString($a->getCell($unit1->l, 0));
				#coopy/CompareTable.hx:179: characters 17-59
				$nb = $av->toString($b->getCell($unit1->r, 0));
				#coopy/CompareTable.hx:180: lines 180-183
				if (array_key_exists($na, $ids_as_map_data) || array_key_exists($nb, $ids_as_map_data)) {
					#coopy/CompareTable.hx:181: characters 21-56
					$index_top->addColumns($unit1->l, $unit1->r);
					#coopy/CompareTable.hx:182: characters 21-48
					$align->addIndexColumns($unit1);
				}
			}

			#coopy/CompareTable.hx:185: characters 13-41
			$index_top->indexTables($a, $b, 1);
			#coopy/CompareTable.hx:186: lines 186-188
			if ($this->indexes !== null) {
				#coopy/CompareTable.hx:187: characters 17-40
				$_this = $this->indexes;
				#coopy/CompareTable.hx:187: characters 17-40
				$_this->arr[$_this->length] = $index_top;
				#coopy/CompareTable.hx:187: characters 17-40
				++$_this->length;
			}
			#coopy/CompareTable.hx:189: lines 189-199
			$_g11 = 0;
			#coopy/CompareTable.hx:189: lines 189-199
			$_g4 = $ha;
			#coopy/CompareTable.hx:189: lines 189-199
			while ($_g11 < $_g4) {
				#coopy/CompareTable.hx:189: lines 189-199
				$_g11 = $_g11 + 1;
				#coopy/CompareTable.hx:189: characters 18-19
				$j = $_g11 - 1;
				#coopy/CompareTable.hx:190: characters 17-65
				$cross = $index_top->queryLocal($j);
				#coopy/CompareTable.hx:191: characters 17-49
				$spot_a = $cross->spot_a;
				#coopy/CompareTable.hx:192: characters 17-49
				$spot_b = $cross->spot_b;
				#coopy/CompareTable.hx:193: characters 17-53
				if (($spot_a !== 1) || ($spot_b !== 1)) {
					#coopy/CompareTable.hx:193: characters 45-53
					continue;
				}
				#coopy/CompareTable.hx:194: characters 17-47
				$jb = ($cross->item_b->lst->arr[0] ?? null);
				#coopy/CompareTable.hx:195: characters 17-33
				$align->link($j, $jb);
				#coopy/CompareTable.hx:196: characters 17-31
				$used->data[$jb] = 1;
				#coopy/CompareTable.hx:197: characters 17-66
				if (!array_key_exists($j, $used_reverse->data)) {
					#coopy/CompareTable.hx:197: characters 46-66
					$reverse_pending_ct = $reverse_pending_ct - 1;
				}
				#coopy/CompareTable.hx:198: characters 17-38
				$used_reverse->data[$j] = 1;
			}

		} else {
			#coopy/CompareTable.hx:206: characters 13-29
			$N = 5;
			#coopy/CompareTable.hx:207: characters 13-57
			$columns = new \Array_hx();
			#coopy/CompareTable.hx:208: lines 208-246
			if ($common_units->length > $N) {
				#coopy/CompareTable.hx:209: characters 17-80
				$columns_eval = new \Array_hx();
				#coopy/CompareTable.hx:210: lines 210-231
				$_g12 = 0;
				#coopy/CompareTable.hx:210: lines 210-231
				$_g5 = $common_units->length;
				#coopy/CompareTable.hx:210: lines 210-231
				while ($_g12 < $_g5) {
					#coopy/CompareTable.hx:210: lines 210-231
					$_g12 = $_g12 + 1;
					#coopy/CompareTable.hx:210: characters 22-23
					$i = $_g12 - 1;
					#coopy/CompareTable.hx:211: characters 21-37
					$ct = 0;
					#coopy/CompareTable.hx:212: characters 48-69
					$this2 = [];
					#coopy/CompareTable.hx:212: characters 48-69
					$mem_data = $this2;
					#coopy/CompareTable.hx:213: characters 49-70
					$this3 = [];
					#coopy/CompareTable.hx:213: characters 49-70
					$mem2_data = $this3;
					#coopy/CompareTable.hx:214: characters 21-53
					$ca = ($common_units->arr[$i] ?? null)->l;
					#coopy/CompareTable.hx:215: characters 21-53
					$cb = ($common_units->arr[$i] ?? null)->r;
					#coopy/CompareTable.hx:216: lines 216-222
					$_g31 = 0;
					#coopy/CompareTable.hx:216: lines 216-222
					$_g21 = $ha;
					#coopy/CompareTable.hx:216: lines 216-222
					while ($_g31 < $_g21) {
						#coopy/CompareTable.hx:216: lines 216-222
						$_g31 = $_g31 + 1;
						#coopy/CompareTable.hx:216: characters 26-27
						$j1 = $_g31 - 1;
						#coopy/CompareTable.hx:217: characters 25-72
						$key = $av->toString($a->getCell($ca, $j1));
						#coopy/CompareTable.hx:218: lines 218-221
						if (!array_key_exists($key, $mem_data)) {
							#coopy/CompareTable.hx:219: characters 29-43
							$mem_data[$key] = 1;
							#coopy/CompareTable.hx:220: characters 29-33
							$ct = $ct + 1;
						}
					}

					#coopy/CompareTable.hx:223: lines 223-229
					$_g32 = 0;
					#coopy/CompareTable.hx:223: lines 223-229
					$_g22 = $hb;
					#coopy/CompareTable.hx:223: lines 223-229
					while ($_g32 < $_g22) {
						#coopy/CompareTable.hx:223: lines 223-229
						$_g32 = $_g32 + 1;
						#coopy/CompareTable.hx:223: characters 26-27
						$j2 = $_g32 - 1;
						#coopy/CompareTable.hx:224: characters 25-72
						$key1 = $av->toString($b->getCell($cb, $j2));
						#coopy/CompareTable.hx:225: lines 225-228
						if (!array_key_exists($key1, $mem2_data)) {
							#coopy/CompareTable.hx:226: characters 29-44
							$mem2_data[$key1] = 1;
							#coopy/CompareTable.hx:227: characters 29-33
							$ct = $ct + 1;
						}
					}

					#coopy/CompareTable.hx:230: characters 21-46
					$columns_eval->arr[$columns_eval->length] = \Array_hx::wrap([
						$i,
						$ct,
					]);
					#coopy/CompareTable.hx:230: characters 21-46
					++$columns_eval->length;

				}

				#coopy/CompareTable.hx:232: lines 232-238
				$sorter = function ($a1, $b1) {
					#coopy/CompareTable.hx:233: characters 21-44
					if (($a1->arr[1] ?? null) < ($b1->arr[1] ?? null)) {
						#coopy/CompareTable.hx:233: characters 36-44
						return 1;
					}
					#coopy/CompareTable.hx:234: characters 21-45
					if (($a1->arr[1] ?? null) > ($b1->arr[1] ?? null)) {
						#coopy/CompareTable.hx:234: characters 36-45
						return -1;
					}
					#coopy/CompareTable.hx:235: characters 21-44
					if (($a1->arr[0] ?? null) > ($b1->arr[0] ?? null)) {
						#coopy/CompareTable.hx:235: characters 36-44
						return 1;
					}
					#coopy/CompareTable.hx:236: characters 21-45
					if (($a1->arr[0] ?? null) < ($b1->arr[0] ?? null)) {
						#coopy/CompareTable.hx:236: characters 36-45
						return -1;
					}
					#coopy/CompareTable.hx:237: characters 21-29
					return 0;
				};
				#coopy/CompareTable.hx:239: characters 17-42
				usort($columns_eval->arr, $sorter);
				#coopy/CompareTable.hx:240: characters 17-24
				$columns = \Lambda::array(\Lambda::map($columns_eval, function ($v) {
					#coopy/CompareTable.hx:240: characters 79-90
					return ($v->arr[0] ?? null);
				}));
				#coopy/CompareTable.hx:241: characters 17-24
				$columns = $columns->slice(0, $N);
			} else {
				#coopy/CompareTable.hx:243: lines 243-245
				$_g13 = 0;
				#coopy/CompareTable.hx:243: lines 243-245
				$_g6 = $common_units->length;
				#coopy/CompareTable.hx:243: lines 243-245
				while ($_g13 < $_g6) {
					#coopy/CompareTable.hx:243: lines 243-245
					$_g13 = $_g13 + 1;
					#coopy/CompareTable.hx:243: characters 22-23
					$i1 = $_g13 - 1;
					#coopy/CompareTable.hx:244: characters 21-36
					$columns->arr[$columns->length] = $i1;
					#coopy/CompareTable.hx:244: characters 21-36
					++$columns->length;

				}
			}
			#coopy/CompareTable.hx:248: characters 13-68
			$top = (int)(floor((2 ** $columns->length) + 0.5));
			#coopy/CompareTable.hx:250: characters 13-61
			$pending = new IntMap();
			#coopy/CompareTable.hx:251: lines 251-253
			$_g14 = 0;
			#coopy/CompareTable.hx:251: lines 251-253
			$_g7 = $ha;
			#coopy/CompareTable.hx:251: lines 251-253
			while ($_g14 < $_g7) {
				#coopy/CompareTable.hx:251: lines 251-253
				$_g14 = $_g14 + 1;
				#coopy/CompareTable.hx:251: characters 18-19
				$j3 = $_g14 - 1;
				#coopy/CompareTable.hx:252: characters 17-33
				$pending->data[$j3] = $j3;
			}

			#coopy/CompareTable.hx:255: characters 13-68
			$added_columns = new IntMap();
			#coopy/CompareTable.hx:256: characters 13-36
			$index_ct = 0;
			#coopy/CompareTable.hx:258: lines 258-321
			$_g15 = 0;
			#coopy/CompareTable.hx:258: lines 258-321
			$_g8 = $top;
			#coopy/CompareTable.hx:258: lines 258-321
			while ($_g15 < $_g8) {
				#coopy/CompareTable.hx:258: lines 258-321
				$_g15 = $_g15 + 1;
				#coopy/CompareTable.hx:258: characters 18-19
				$k = $_g15 - 1;
				#coopy/CompareTable.hx:259: characters 17-35
				if ($k === 0) {
					#coopy/CompareTable.hx:259: characters 27-35
					continue;
				}
				#coopy/CompareTable.hx:260: characters 17-43
				if ($pending_ct === 0) {
					#coopy/CompareTable.hx:260: characters 38-43
					break;
				}
				#coopy/CompareTable.hx:261: characters 17-68
				$active_columns = new \Array_hx();
				#coopy/CompareTable.hx:262: characters 17-34
				$kk = $k;
				#coopy/CompareTable.hx:263: characters 17-34
				$at = 0;
				#coopy/CompareTable.hx:264: lines 264-270
				while ($kk > 0) {
					#coopy/CompareTable.hx:265: lines 265-267
					if (($kk % 2) === 1) {
						#coopy/CompareTable.hx:266: characters 25-57
						$active_columns->arr[$active_columns->length] = ($columns->arr[$at] ?? null);
						#coopy/CompareTable.hx:266: characters 25-57
						++$active_columns->length;
					}
					#coopy/CompareTable.hx:268: characters 21-29
					$kk = $kk >> 1;
					#coopy/CompareTable.hx:269: characters 21-25
					$at = $at + 1;
				}
				#coopy/CompareTable.hx:272: characters 17-75
				$index = new IndexPair($this->comp->compare_flags);
				#coopy/CompareTable.hx:273: lines 273-281
				$_g33 = 0;
				#coopy/CompareTable.hx:273: lines 273-281
				$_g23 = $active_columns->length;
				#coopy/CompareTable.hx:273: lines 273-281
				while ($_g33 < $_g23) {
					#coopy/CompareTable.hx:273: lines 273-281
					$_g33 = $_g33 + 1;
					#coopy/CompareTable.hx:273: characters 22-23
					$k1 = $_g33 - 1;
					#coopy/CompareTable.hx:274: characters 21-55
					$col = ($active_columns->arr[$k1] ?? null);
					#coopy/CompareTable.hx:275: characters 21-57
					$unit2 = ($common_units->arr[$col] ?? null);
					#coopy/CompareTable.hx:276: characters 21-52
					$index->addColumns($unit2->l, $unit2->r);
					#coopy/CompareTable.hx:277: lines 277-280
					if (!array_key_exists($col, $added_columns->data)) {
						#coopy/CompareTable.hx:278: characters 25-52
						$align->addIndexColumns($unit2);
						#coopy/CompareTable.hx:279: characters 25-52
						$added_columns->data[$col] = true;
					}
				}

				#coopy/CompareTable.hx:282: characters 17-41
				$index->indexTables($a, $b, 1);
				#coopy/CompareTable.hx:283: characters 17-48
				if ($k === ($top - 1)) {
					#coopy/CompareTable.hx:283: characters 31-40
					$index_top = $index;
				}
				#coopy/CompareTable.hx:285: characters 17-40
				$h = $a->get_height();
				#coopy/CompareTable.hx:286: characters 17-45
				if ($b->get_height() > $h) {
					#coopy/CompareTable.hx:286: characters 33-34
					$h = $b->get_height();
				}
				#coopy/CompareTable.hx:287: characters 17-31
				if ($h < 1) {
					#coopy/CompareTable.hx:287: characters 26-27
					$h = 1;
				}
				#coopy/CompareTable.hx:288: characters 17-62
				$wide_top_freq = $index->getTopFreq();
				#coopy/CompareTable.hx:289: characters 17-51
				$ratio = $wide_top_freq;
				#coopy/CompareTable.hx:290: characters 17-32
				$ratio = $ratio / ($h + 20);
				#coopy/CompareTable.hx:291: lines 291-295
				if ($ratio >= 0.1) {
					#coopy/CompareTable.hx:293: characters 21-56
					if (($index_ct > 0) || ($k < ($top - 1))) {
						#coopy/CompareTable.hx:293: characters 48-56
						continue;
					}
				}
				#coopy/CompareTable.hx:297: characters 17-27
				$index_ct = $index_ct + 1;
				#coopy/CompareTable.hx:298: lines 298-300
				if ($this->indexes !== null) {
					#coopy/CompareTable.hx:299: characters 21-40
					$_this1 = $this->indexes;
					#coopy/CompareTable.hx:299: characters 21-40
					$_this1->arr[$_this1->length] = $index;
					#coopy/CompareTable.hx:299: characters 21-40
					++$_this1->length;
				}
				#coopy/CompareTable.hx:302: characters 17-59
				$fixed = new \Array_hx();
				#coopy/CompareTable.hx:303: characters 27-41
				$j4 = new NativeArrayIterator(array_keys($pending->data));
				#coopy/CompareTable.hx:303: characters 27-41
				while ($j4->hasNext()) {
					#coopy/CompareTable.hx:303: lines 303-316
					$j5 = $j4->next();
					#coopy/CompareTable.hx:304: characters 21-65
					$cross1 = $index->queryLocal($j5);
					#coopy/CompareTable.hx:305: characters 21-53
					$spot_a1 = $cross1->spot_a;
					#coopy/CompareTable.hx:306: characters 21-53
					$spot_b1 = $cross1->spot_b;
					#coopy/CompareTable.hx:307: characters 21-57
					if (($spot_a1 !== 1) || ($spot_b1 !== 1)) {
						#coopy/CompareTable.hx:307: characters 49-57
						continue;
					}
					#coopy/CompareTable.hx:308: characters 21-52
					$val = ($cross1->item_b->lst->arr[0] ?? null);
					#coopy/CompareTable.hx:309: lines 309-315
					if (!array_key_exists($val, $used->data)) {
						#coopy/CompareTable.hx:310: characters 25-38
						$fixed->arr[$fixed->length] = $j5;
						#coopy/CompareTable.hx:310: characters 25-38
						++$fixed->length;

						#coopy/CompareTable.hx:311: characters 25-42
						$align->link($j5, $val);
						#coopy/CompareTable.hx:312: characters 25-40
						$used->data[$val] = 1;
						#coopy/CompareTable.hx:313: characters 25-74
						if (!array_key_exists($j5, $used_reverse->data)) {
							#coopy/CompareTable.hx:313: characters 54-74
							$reverse_pending_ct = $reverse_pending_ct - 1;
						}
						#coopy/CompareTable.hx:314: characters 25-46
						$used_reverse->data[$j5] = 1;
					}
				}

				#coopy/CompareTable.hx:317: lines 317-320
				$_g34 = 0;
				#coopy/CompareTable.hx:317: lines 317-320
				$_g24 = $fixed->length;
				#coopy/CompareTable.hx:317: lines 317-320
				while ($_g34 < $_g24) {
					#coopy/CompareTable.hx:317: lines 317-320
					$_g34 = $_g34 + 1;
					#coopy/CompareTable.hx:317: characters 22-23
					$j6 = $_g34 - 1;
					#coopy/CompareTable.hx:318: characters 21-45
					$pending->remove(($fixed->arr[$j6] ?? null));
					#coopy/CompareTable.hx:319: characters 21-33
					$pending_ct = $pending_ct - 1;
				}

			}

		}
		#coopy/CompareTable.hx:323: lines 323-389
		if ($index_top !== null) {
			#coopy/CompareTable.hx:327: characters 13-34
			$offset = 0;
			#coopy/CompareTable.hx:328: characters 13-33
			$scale = 1;
			#coopy/CompareTable.hx:329: lines 329-357
			$_g9 = 0;
			#coopy/CompareTable.hx:329: lines 329-357
			while ($_g9 < 2) {
				#coopy/CompareTable.hx:329: lines 329-357
				$_g9 = $_g9 + 1;
				#coopy/CompareTable.hx:329: characters 18-21
				$sgn = $_g9 - 1;
				#coopy/CompareTable.hx:330: lines 330-354
				if ($pending_ct > 0) {
					#coopy/CompareTable.hx:331: characters 21-47
					$xb = null;
					#coopy/CompareTable.hx:332: characters 21-53
					if (($scale === -1) && ($hb > 0)) {
						#coopy/CompareTable.hx:332: characters 44-46
						$xb = $hb - 1;
					}
					#coopy/CompareTable.hx:333: lines 333-353
					$_g25 = 0;
					#coopy/CompareTable.hx:333: lines 333-353
					$_g16 = $ha;
					#coopy/CompareTable.hx:333: lines 333-353
					while ($_g25 < $_g16) {
						#coopy/CompareTable.hx:333: lines 333-353
						$_g25 = $_g25 + 1;
						#coopy/CompareTable.hx:333: characters 26-29
						$xa0 = $_g25 - 1;
						#coopy/CompareTable.hx:334: characters 25-59
						$xa = $xa0 * $scale + $offset;
						#coopy/CompareTable.hx:335: characters 25-61
						$xb2 = $align->a2b($xa);
						#coopy/CompareTable.hx:336: lines 336-340
						if ($xb2 !== null) {
							#coopy/CompareTable.hx:337: characters 29-31
							$xb = $xb2 + $scale;
							#coopy/CompareTable.hx:338: characters 29-52
							if (($xb >= $hb) || ($xb < 0)) {
								#coopy/CompareTable.hx:338: characters 47-52
								break;
							}
							#coopy/CompareTable.hx:339: characters 29-37
							continue;
						}
						#coopy/CompareTable.hx:341: characters 25-47
						if ($xb === null) {
							#coopy/CompareTable.hx:341: characters 39-47
							continue;
						}
						#coopy/CompareTable.hx:342: characters 25-57
						$ka = $index_top->localKey($xa);
						#coopy/CompareTable.hx:343: characters 25-58
						$kb = $index_top->remoteKey($xb);
						#coopy/CompareTable.hx:344: characters 25-45
						if ($ka !== $kb) {
							#coopy/CompareTable.hx:344: characters 37-45
							continue;
						}
						#coopy/CompareTable.hx:345: characters 25-54
						if (array_key_exists($xb, $used->data)) {
							#coopy/CompareTable.hx:345: characters 46-54
							continue;
						}
						#coopy/CompareTable.hx:346: characters 25-42
						$align->link($xa, $xb);
						#coopy/CompareTable.hx:347: characters 25-39
						$used->data[$xb] = 1;
						#coopy/CompareTable.hx:348: characters 25-47
						$used_reverse->data[$xa] = 1;
						#coopy/CompareTable.hx:349: characters 25-37
						$pending_ct = $pending_ct - 1;
						#coopy/CompareTable.hx:350: characters 25-34
						$xb = $xb + $scale;
						#coopy/CompareTable.hx:351: characters 25-48
						if (($xb >= $hb) || ($xb < 0)) {
							#coopy/CompareTable.hx:351: characters 43-48
							break;
						}
						#coopy/CompareTable.hx:352: characters 25-49
						if ($pending_ct === 0) {
							#coopy/CompareTable.hx:352: characters 44-49
							break;
						}
					}

				}
				#coopy/CompareTable.hx:355: characters 17-23
				$offset = $ha - 1;
				#coopy/CompareTable.hx:356: characters 17-22
				$scale = -1;
			}

			#coopy/CompareTable.hx:358: characters 13-19
			$offset = 0;
			#coopy/CompareTable.hx:359: characters 13-18
			$scale = 1;
			#coopy/CompareTable.hx:360: lines 360-388
			$_g10 = 0;
			#coopy/CompareTable.hx:360: lines 360-388
			while ($_g10 < 2) {
				#coopy/CompareTable.hx:360: lines 360-388
				$_g10 = $_g10 + 1;
				#coopy/CompareTable.hx:360: characters 18-21
				$sgn1 = $_g10 - 1;
				#coopy/CompareTable.hx:361: lines 361-385
				if ($reverse_pending_ct > 0) {
					#coopy/CompareTable.hx:362: characters 21-47
					$xa1 = null;
					#coopy/CompareTable.hx:363: characters 21-53
					if (($scale === -1) && ($ha > 0)) {
						#coopy/CompareTable.hx:363: characters 44-46
						$xa1 = $ha - 1;
					}
					#coopy/CompareTable.hx:364: lines 364-384
					$_g26 = 0;
					#coopy/CompareTable.hx:364: lines 364-384
					$_g17 = $hb;
					#coopy/CompareTable.hx:364: lines 364-384
					while ($_g26 < $_g17) {
						#coopy/CompareTable.hx:364: lines 364-384
						$_g26 = $_g26 + 1;
						#coopy/CompareTable.hx:364: characters 26-29
						$xb0 = $_g26 - 1;
						#coopy/CompareTable.hx:365: characters 25-59
						$xb1 = $xb0 * $scale + $offset;
						#coopy/CompareTable.hx:366: characters 25-61
						$xa2 = $align->b2a($xb1);
						#coopy/CompareTable.hx:367: lines 367-371
						if ($xa2 !== null) {
							#coopy/CompareTable.hx:368: characters 29-31
							$xa1 = $xa2 + $scale;
							#coopy/CompareTable.hx:369: characters 29-52
							if (($xa1 >= $ha) || ($xa1 < 0)) {
								#coopy/CompareTable.hx:369: characters 47-52
								break;
							}
							#coopy/CompareTable.hx:370: characters 29-37
							continue;
						}
						#coopy/CompareTable.hx:372: characters 25-47
						if ($xa1 === null) {
							#coopy/CompareTable.hx:372: characters 39-47
							continue;
						}
						#coopy/CompareTable.hx:373: characters 25-57
						$ka1 = $index_top->localKey($xa1);
						#coopy/CompareTable.hx:374: characters 25-58
						$kb1 = $index_top->remoteKey($xb1);
						#coopy/CompareTable.hx:375: characters 25-45
						if ($ka1 !== $kb1) {
							#coopy/CompareTable.hx:375: characters 37-45
							continue;
						}
						#coopy/CompareTable.hx:376: characters 25-62
						if (array_key_exists($xa1, $used_reverse->data)) {
							#coopy/CompareTable.hx:376: characters 54-62
							continue;
						}
						#coopy/CompareTable.hx:377: characters 25-42
						$align->link($xa1, $xb1);
						#coopy/CompareTable.hx:378: characters 25-39
						$used->data[$xb1] = 1;
						#coopy/CompareTable.hx:379: characters 25-47
						$used_reverse->data[$xa1] = 1;
						#coopy/CompareTable.hx:380: characters 25-45
						$reverse_pending_ct = $reverse_pending_ct - 1;
						#coopy/CompareTable.hx:381: characters 25-34
						$xa1 = $xa1 + $scale;
						#coopy/CompareTable.hx:382: characters 25-48
						if (($xa1 >= $ha) || ($xa1 < 0)) {
							#coopy/CompareTable.hx:382: characters 43-48
							break;
						}
						#coopy/CompareTable.hx:383: characters 25-57
						if ($reverse_pending_ct === 0) {
							#coopy/CompareTable.hx:383: characters 52-57
							break;
						}
					}

				}
				#coopy/CompareTable.hx:386: characters 17-23
				$offset = $hb - 1;
				#coopy/CompareTable.hx:387: characters 17-22
				$scale = -1;
			}

		}
		#coopy/CompareTable.hx:391: lines 391-395
		$_g18 = 1;
		#coopy/CompareTable.hx:391: lines 391-395
		$_g19 = $ha;
		#coopy/CompareTable.hx:391: lines 391-395
		while ($_g18 < $_g19) {
			#coopy/CompareTable.hx:391: lines 391-395
			$_g18 = $_g18 + 1;
			#coopy/CompareTable.hx:391: characters 14-15
			$i2 = $_g18 - 1;
			#coopy/CompareTable.hx:392: lines 392-394
			if (!array_key_exists($i2, $used_reverse->data)) {
				#coopy/CompareTable.hx:393: characters 17-33
				$align->link($i2, -1);
			}
		}

		#coopy/CompareTable.hx:396: lines 396-400
		$_g110 = 1;
		#coopy/CompareTable.hx:396: lines 396-400
		$_g20 = $hb;
		#coopy/CompareTable.hx:396: lines 396-400
		while ($_g110 < $_g20) {
			#coopy/CompareTable.hx:396: lines 396-400
			$_g110 = $_g110 + 1;
			#coopy/CompareTable.hx:396: characters 14-15
			$i3 = $_g110 - 1;
			#coopy/CompareTable.hx:397: lines 397-399
			if (!array_key_exists($i3, $used->data)) {
				#coopy/CompareTable.hx:398: characters 17-33
				$align->link(-1, $i3);
			}
		}

		#coopy/CompareTable.hx:402: lines 402-405
		if (($ha > 0) && ($hb > 0)) {
			#coopy/CompareTable.hx:403: characters 13-28
			$align->link(0, 0);
			#coopy/CompareTable.hx:404: characters 13-31
			$align->headers(0, 0);
		}
	}


	/**
	 * @return bool
	 */
	public function compareCore () {
		#coopy/CompareTable.hx:593: characters 9-41
		if ($this->comp->completed) {
			#coopy/CompareTable.hx:593: characters 29-41
			return false;
		}
		#coopy/CompareTable.hx:594: lines 594-596
		if (!$this->comp->is_equal_known) {
			#coopy/CompareTable.hx:595: characters 13-33
			return $this->testIsEqual();
		}
		#coopy/CompareTable.hx:597: lines 597-599
		if (!$this->comp->has_same_columns_known) {
			#coopy/CompareTable.hx:598: characters 13-40
			return $this->testHasSameColumns();
		}
		#coopy/CompareTable.hx:600: characters 9-30
		$this->comp->completed = true;
		#coopy/CompareTable.hx:601: characters 9-21
		return false;
	}


	/**
	 * @return TableComparisonState
	 */
	public function getComparisonState () {
		#coopy/CompareTable.hx:80: characters 9-20
		return $this->comp;
	}


	/**
	 * @return \Array_hx
	 */
	public function getIndexes () {
		#coopy/CompareTable.hx:628: characters 9-23
		return $this->indexes;
	}


	/**
	 * @param Table $a
	 * @param Table $b
	 * 
	 * @return bool
	 */
	public function hasSameColumns2 ($a, $b) {
		#coopy/CompareTable.hx:529: lines 529-531
		if ($a->get_width() !== $b->get_width()) {
			#coopy/CompareTable.hx:530: characters 13-25
			return false;
		}
		#coopy/CompareTable.hx:532: lines 532-534
		if (($a->get_height() === 0) || ($b->get_height() === 0)) {
			#coopy/CompareTable.hx:533: characters 13-24
			return true;
		}
		#coopy/CompareTable.hx:538: characters 9-41
		$av = $a->getCellView();
		#coopy/CompareTable.hx:539: lines 539-548
		$_g1 = 0;
		#coopy/CompareTable.hx:539: lines 539-548
		$_g = $a->get_width();
		#coopy/CompareTable.hx:539: lines 539-548
		while ($_g1 < $_g) {
			#coopy/CompareTable.hx:539: lines 539-548
			$_g1 = $_g1 + 1;
			#coopy/CompareTable.hx:539: characters 14-15
			$i = $_g1 - 1;
			#coopy/CompareTable.hx:540: lines 540-544
			$_g3 = $i + 1;
			#coopy/CompareTable.hx:540: lines 540-544
			$_g2 = $a->get_width();
			#coopy/CompareTable.hx:540: lines 540-544
			while ($_g3 < $_g2) {
				#coopy/CompareTable.hx:540: lines 540-544
				$_g3 = $_g3 + 1;
				#coopy/CompareTable.hx:540: characters 18-19
				$j = $_g3 - 1;
				#coopy/CompareTable.hx:541: lines 541-543
				if ($av->equals($a->getCell($i, 0), $a->getCell($j, 0))) {
					#coopy/CompareTable.hx:542: characters 21-33
					return false;
				}
			}

			#coopy/CompareTable.hx:545: lines 545-547
			if (!$av->equals($a->getCell($i, 0), $b->getCell($i, 0))) {
				#coopy/CompareTable.hx:546: characters 17-29
				return false;
			}
		}

		#coopy/CompareTable.hx:550: characters 9-20
		return true;
	}


	/**
	 * @param Table $a
	 * @param Table $b
	 * 
	 * @return bool
	 */
	public function isEqual2 ($a, $b) {
		#coopy/CompareTable.hx:578: lines 578-580
		if (($a->get_width() !== $b->get_width()) || ($a->get_height() !== $b->get_height())) {
			#coopy/CompareTable.hx:579: characters 13-25
			return false;
		}
		#coopy/CompareTable.hx:581: characters 9-41
		$av = $a->getCellView();
		#coopy/CompareTable.hx:582: lines 582-588
		$_g1 = 0;
		#coopy/CompareTable.hx:582: lines 582-588
		$_g = $a->get_height();
		#coopy/CompareTable.hx:582: lines 582-588
		while ($_g1 < $_g) {
			#coopy/CompareTable.hx:582: lines 582-588
			$_g1 = $_g1 + 1;
			#coopy/CompareTable.hx:582: characters 14-15
			$i = $_g1 - 1;
			#coopy/CompareTable.hx:583: lines 583-587
			$_g3 = 0;
			#coopy/CompareTable.hx:583: lines 583-587
			$_g2 = $a->get_width();
			#coopy/CompareTable.hx:583: lines 583-587
			while ($_g3 < $_g2) {
				#coopy/CompareTable.hx:583: lines 583-587
				$_g3 = $_g3 + 1;
				#coopy/CompareTable.hx:583: characters 18-19
				$j = $_g3 - 1;
				#coopy/CompareTable.hx:584: lines 584-586
				if (!$av->equals($a->getCell($j, $i), $b->getCell($j, $i))) {
					#coopy/CompareTable.hx:585: characters 21-33
					return false;
				}
			}

		}

		#coopy/CompareTable.hx:589: characters 9-20
		return true;
	}


	/**
	 * @return bool
	 */
	public function run () {
		#coopy/CompareTable.hx:41: lines 41-44
		if ($this->useSql()) {
			#coopy/CompareTable.hx:42: characters 13-34
			$this->comp->completed = true;
			#coopy/CompareTable.hx:43: characters 13-25
			return false;
		}
		#coopy/CompareTable.hx:45: characters 9-41
		$more = $this->compareCore();
		#coopy/CompareTable.hx:46: lines 46-48
		while ($more && $this->comp->run_to_completion) {
			#coopy/CompareTable.hx:47: characters 13-33
			$more = $this->compareCore();
		}
		#coopy/CompareTable.hx:49: characters 9-21
		return !$more;
	}


	/**
	 * @return void
	 */
	public function storeIndexes () {
		#coopy/CompareTable.hx:613: characters 9-41
		$this->indexes = new \Array_hx();
	}


	/**
	 * @return bool
	 */
	public function testHasSameColumns () {
		#coopy/CompareTable.hx:516: characters 9-32
		$p = $this->comp->p;
		#coopy/CompareTable.hx:517: characters 9-32
		$a = $this->comp->a;
		#coopy/CompareTable.hx:518: characters 9-32
		$b = $this->comp->b;
		#coopy/CompareTable.hx:519: characters 9-46
		$eq = $this->hasSameColumns2($a, $b);
		#coopy/CompareTable.hx:520: lines 520-522
		if ($eq && ($p !== null)) {
			#coopy/CompareTable.hx:521: characters 13-38
			$eq = $this->hasSameColumns2($p, $a);
		}
		#coopy/CompareTable.hx:523: characters 9-35
		$this->comp->has_same_columns = $eq;
		#coopy/CompareTable.hx:524: characters 9-43
		$this->comp->has_same_columns_known = true;
		#coopy/CompareTable.hx:525: characters 9-20
		return true;
	}


	/**
	 * @return bool
	 */
	public function testIsEqual () {
		#coopy/CompareTable.hx:554: characters 9-32
		$p = $this->comp->p;
		#coopy/CompareTable.hx:555: characters 9-32
		$a = $this->comp->a;
		#coopy/CompareTable.hx:556: characters 9-32
		$b = $this->comp->b;
		#coopy/CompareTable.hx:557: characters 9-23
		$this->comp->getMeta();
		#coopy/CompareTable.hx:558: characters 9-28
		$nested = false;
		#coopy/CompareTable.hx:559: characters 9-73
		if ($this->comp->p_meta !== null) {
			#coopy/CompareTable.hx:559: characters 32-73
			if ($this->comp->p_meta->isNested()) {
				#coopy/CompareTable.hx:559: characters 60-73
				$nested = true;
			}
		}
		#coopy/CompareTable.hx:560: characters 9-73
		if ($this->comp->a_meta !== null) {
			#coopy/CompareTable.hx:560: characters 32-73
			if ($this->comp->a_meta->isNested()) {
				#coopy/CompareTable.hx:560: characters 60-73
				$nested = true;
			}
		}
		#coopy/CompareTable.hx:561: characters 9-73
		if ($this->comp->b_meta !== null) {
			#coopy/CompareTable.hx:561: characters 32-73
			if ($this->comp->b_meta->isNested()) {
				#coopy/CompareTable.hx:561: characters 60-73
				$nested = true;
			}
		}
		#coopy/CompareTable.hx:562: lines 562-567
		if ($nested) {
			#coopy/CompareTable.hx:564: characters 13-34
			$this->comp->is_equal = false;
			#coopy/CompareTable.hx:565: characters 13-39
			$this->comp->is_equal_known = true;
			#coopy/CompareTable.hx:566: characters 13-24
			return true;
		}
		#coopy/CompareTable.hx:568: characters 9-39
		$eq = $this->isEqual2($a, $b);
		#coopy/CompareTable.hx:569: lines 569-571
		if ($eq && ($p !== null)) {
			#coopy/CompareTable.hx:570: characters 13-31
			$eq = $this->isEqual2($p, $a);
		}
		#coopy/CompareTable.hx:572: characters 9-27
		$this->comp->is_equal = $eq;
		#coopy/CompareTable.hx:573: characters 9-35
		$this->comp->is_equal_known = true;
		#coopy/CompareTable.hx:574: characters 9-20
		return true;
	}


	/**
	 * @return bool
	 */
	public function useSql () {
		#coopy/CompareTable.hx:632: characters 9-53
		if ($this->comp->compare_flags === null) {
			#coopy/CompareTable.hx:632: characters 41-53
			return false;
		}
		#coopy/CompareTable.hx:633: characters 9-23
		$this->comp->getMeta();
		#coopy/CompareTable.hx:634: characters 9-24
		$sql = true;
		#coopy/CompareTable.hx:635: characters 9-69
		if ($this->comp->p_meta !== null) {
			#coopy/CompareTable.hx:635: characters 32-69
			if (!$this->comp->p_meta->isSql()) {
				#coopy/CompareTable.hx:635: characters 58-69
				$sql = false;
			}
		}
		#coopy/CompareTable.hx:636: characters 9-69
		if ($this->comp->a_meta !== null) {
			#coopy/CompareTable.hx:636: characters 32-69
			if (!$this->comp->a_meta->isSql()) {
				#coopy/CompareTable.hx:636: characters 58-69
				$sql = false;
			}
		}
		#coopy/CompareTable.hx:637: characters 9-69
		if ($this->comp->b_meta !== null) {
			#coopy/CompareTable.hx:637: characters 32-69
			if (!$this->comp->b_meta->isSql()) {
				#coopy/CompareTable.hx:637: characters 58-69
				$sql = false;
			}
		}
		#coopy/CompareTable.hx:638: characters 9-59
		if (($this->comp->p !== null) && ($this->comp->p_meta === null)) {
			#coopy/CompareTable.hx:638: characters 48-59
			$sql = false;
		}
		#coopy/CompareTable.hx:639: characters 9-59
		if (($this->comp->a !== null) && ($this->comp->a_meta === null)) {
			#coopy/CompareTable.hx:639: characters 48-59
			$sql = false;
		}
		#coopy/CompareTable.hx:640: characters 9-59
		if (($this->comp->b !== null) && ($this->comp->b_meta === null)) {
			#coopy/CompareTable.hx:640: characters 48-59
			$sql = false;
		}
		#coopy/CompareTable.hx:641: characters 9-19
		return $sql;
	}
}


Boot::registerClass(CompareTable::class, 'coopy.CompareTable');
