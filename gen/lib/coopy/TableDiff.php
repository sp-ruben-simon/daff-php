<?php
/**
 * Generated by Haxe 4.0.0 (git build development @ 3988422)
 */

namespace coopy;

use \haxe\ds\StringMap;
use \php\Boot;
use \php\_Boot\HxString;
use \haxe\ds\IntMap;

class TableDiff {
	/**
	 * @var Table
	 */
	public $a;
	/**
	 * @var string
	 */
	public $act;
	/**
	 * @var \Array_hx
	 */
	public $active_column;
	/**
	 * @var \Array_hx
	 */
	public $active_row;
	/**
	 * @var Alignment
	 */
	public $align;
	/**
	 * @var bool
	 */
	public $allow_delete;
	/**
	 * @var bool
	 */
	public $allow_insert;
	/**
	 * @var bool
	 */
	public $allow_update;
	/**
	 * @var Table
	 */
	public $b;
	/**
	 * @var CellBuilder
	 */
	public $builder;
	/**
	 * @var int
	 */
	public $col_deletes;
	/**
	 * @var int
	 */
	public $col_inserts;
	/**
	 * @var IntMap
	 */
	public $col_map;
	/**
	 * @var IntMap
	 */
	public $col_moves;
	/**
	 * @var int
	 */
	public $col_renames;
	/**
	 * @var int
	 */
	public $col_reorders;
	/**
	 * @var int
	 */
	public $col_updates;
	/**
	 * @var \Array_hx
	 */
	public $column_units;
	/**
	 * @var IntMap
	 */
	public $column_units_updated;
	/**
	 * @var string
	 */
	public $conflict_sep;
	/**
	 * @var bool
	 */
	public $diff_found;
	/**
	 * @var CompareFlags
	 */
	public $flags;
	/**
	 * @var bool
	 */
	public $has_parent;
	/**
	 * @var bool
	 */
	public $have_addition;
	/**
	 * @var bool
	 */
	public $have_schema;
	/**
	 * @var IntMap
	 */
	public $is_index_a;
	/**
	 * @var IntMap
	 */
	public $is_index_b;
	/**
	 * @var IntMap
	 */
	public $is_index_p;
	/**
	 * @var bool
	 */
	public $nested;
	/**
	 * @var bool
	 */
	public $nesting_present;
	/**
	 * @var Ordering
	 */
	public $order;
	/**
	 * @var Table
	 */
	public $p;
	/**
	 * @var bool
	 */
	public $preserve_columns;
	/**
	 * @var bool
	 */
	public $publish;
	/**
	 * @var int
	 */
	public $ra_header;
	/**
	 * @var int
	 */
	public $rb_header;
	/**
	 * @var int
	 */
	public $row_deletes;
	/**
	 * @var int
	 */
	public $row_inserts;
	/**
	 * @var IntMap
	 */
	public $row_map;
	/**
	 * @var IntMap
	 */
	public $row_moves;
	/**
	 * @var int
	 */
	public $row_reorders;
	/**
	 * @var \Array_hx
	 */
	public $row_units;
	/**
	 * @var int
	 */
	public $row_updates;
	/**
	 * @var int
	 */
	public $rp_header;
	/**
	 * @var \Array_hx
	 */
	public $schema;
	/**
	 * @var bool
	 */
	public $schema_diff_found;
	/**
	 * @var string
	 */
	public $sep;
	/**
	 * @var bool
	 */
	public $show_rc_numbers;
	/**
	 * @var bool
	 */
	public $top_line_done;
	/**
	 * @var View
	 */
	public $v;


	/**
	 * @param Alignment $align
	 * @param CompareFlags $flags
	 * 
	 * @return void
	 */
	public function __construct ($align, $flags) {
		#coopy/TableDiff.hx:89: characters 9-27
		$this->align = $align;
		#coopy/TableDiff.hx:90: characters 9-27
		$this->flags = $flags;
		#coopy/TableDiff.hx:91: characters 9-23
		$this->builder = null;
		#coopy/TableDiff.hx:92: characters 9-33
		$this->preserve_columns = false;
	}


	/**
	 * @param Table $output
	 * 
	 * @return void
	 */
	public function addHeader ($output) {
		#coopy/TableDiff.hx:574: lines 574-599
		if ($this->flags->always_show_header) {
			#coopy/TableDiff.hx:575: characters 13-42
			$at = $output->get_height();
			#coopy/TableDiff.hx:576: characters 13-54
			$output->resize($this->column_units->length + 1, $at + 1);
			#coopy/TableDiff.hx:577: characters 13-54
			$output->setCell(0, $at, $this->builder->marker("@@"));
			#coopy/TableDiff.hx:578: lines 578-597
			$_g1 = 0;
			#coopy/TableDiff.hx:578: lines 578-597
			$_g = $this->column_units->length;
			#coopy/TableDiff.hx:578: lines 578-597
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:578: lines 578-597
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:578: characters 18-19
				$j = $_g1 - 1;
				#coopy/TableDiff.hx:579: characters 17-52
				$cunit = ($this->column_units->arr[$j] ?? null);
				#coopy/TableDiff.hx:580: lines 580-595
				if ($cunit->r >= 0) {
					#coopy/TableDiff.hx:581: lines 581-584
					if ($this->b->get_height() !== 0) {
						#coopy/TableDiff.hx:582: lines 582-583
						$output->setCell($j + 1, $at, $this->b->getCell($cunit->r, $this->rb_header));
					}
				} else if ($cunit->l >= 0) {
					#coopy/TableDiff.hx:586: lines 586-589
					if ($this->a->get_height() !== 0) {
						#coopy/TableDiff.hx:587: lines 587-588
						$output->setCell($j + 1, $at, $this->a->getCell($cunit->l, $this->ra_header));
					}
				} else if ($cunit->lp() >= 0) {
					#coopy/TableDiff.hx:591: lines 591-594
					if ($this->p->get_height() !== 0) {
						#coopy/TableDiff.hx:592: lines 592-593
						$output->setCell($j + 1, $at, $this->p->getCell($cunit->lp(), $this->rp_header));
					}
				}
				#coopy/TableDiff.hx:596: characters 17-39
				$this->col_map->data[$j + 1] = $cunit;
			}

			#coopy/TableDiff.hx:598: characters 13-33
			$this->top_line_done = true;
		}
	}


	/**
	 * @param Table $output
	 * 
	 * @return bool
	 */
	public function addMeta ($output) {
		#coopy/TableDiff.hx:626: characters 9-52
		if (($this->a === null) && ($this->b === null) && ($this->p === null)) {
			#coopy/TableDiff.hx:626: characters 40-52
			return false;
		}
		#coopy/TableDiff.hx:627: characters 9-43
		if (!$this->flags->show_meta) {
			#coopy/TableDiff.hx:627: characters 31-43
			return false;
		}
		#coopy/TableDiff.hx:629: characters 9-46
		$a_meta = $this->getMetaTable($this->a);
		#coopy/TableDiff.hx:630: characters 9-46
		$b_meta = $this->getMetaTable($this->b);
		#coopy/TableDiff.hx:631: characters 9-46
		$p_meta = $this->getMetaTable($this->p);
		#coopy/TableDiff.hx:632: characters 9-47
		if (!$this->checkMeta($this->a, $a_meta)) {
			#coopy/TableDiff.hx:632: characters 35-47
			return false;
		}
		#coopy/TableDiff.hx:633: characters 9-47
		if (!$this->checkMeta($this->b, $b_meta)) {
			#coopy/TableDiff.hx:633: characters 35-47
			return false;
		}
		#coopy/TableDiff.hx:634: characters 9-47
		if (!$this->checkMeta($this->p, $p_meta)) {
			#coopy/TableDiff.hx:634: characters 35-47
			return false;
		}
		#coopy/TableDiff.hx:638: characters 9-46
		$meta_diff = new SimpleTable(0, 0);
		#coopy/TableDiff.hx:639: characters 9-45
		$meta_flags = new CompareFlags();
		#coopy/TableDiff.hx:640: characters 9-39
		$meta_flags->addPrimaryKey("@@");
		#coopy/TableDiff.hx:641: characters 9-38
		$meta_flags->addPrimaryKey("@");
		#coopy/TableDiff.hx:642: characters 9-52
		$meta_flags->unchanged_column_context = 65536;
		#coopy/TableDiff.hx:643: characters 9-41
		$meta_flags->unchanged_context = 0;
		#coopy/TableDiff.hx:644: characters 9-110
		$meta_align = Coopy::compareTables3(($a_meta === $p_meta ? null : $p_meta), $a_meta, $b_meta, $meta_flags)->align();
		#coopy/TableDiff.hx:645: characters 9-55
		$td = new TableDiff($meta_align, $meta_flags);
		#coopy/TableDiff.hx:646: characters 9-35
		$td->preserve_columns = true;
		#coopy/TableDiff.hx:647: characters 9-29
		$td->hilite($meta_diff);
		#coopy/TableDiff.hx:649: lines 649-674
		if ($td->hasDifference() || $td->hasSchemaDifference()) {
			#coopy/TableDiff.hx:650: characters 13-35
			$h = $output->get_height();
			#coopy/TableDiff.hx:651: characters 13-39
			$dh = $meta_diff->get_height();
			#coopy/TableDiff.hx:652: characters 13-55
			$offset = ($td->hasSchemaDifference() ? 2 : 1);
			#coopy/TableDiff.hx:653: characters 13-52
			$output->resize($output->get_width(), $h + $dh - $offset);
			#coopy/TableDiff.hx:654: characters 13-45
			$v = $meta_diff->getCellView();
			#coopy/TableDiff.hx:655: lines 655-663
			$_g1 = $offset;
			#coopy/TableDiff.hx:655: lines 655-663
			$_g = $dh;
			#coopy/TableDiff.hx:655: lines 655-663
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:655: lines 655-663
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:655: characters 18-19
				$y = $_g1 - 1;
				#coopy/TableDiff.hx:656: lines 656-662
				$_g3 = 1;
				#coopy/TableDiff.hx:656: lines 656-662
				$_g2 = $meta_diff->get_width();
				#coopy/TableDiff.hx:656: lines 656-662
				while ($_g3 < $_g2) {
					#coopy/TableDiff.hx:656: lines 656-662
					$_g3 = $_g3 + 1;
					#coopy/TableDiff.hx:656: characters 22-23
					$x = $_g3 - 1;
					#coopy/TableDiff.hx:657: characters 21-52
					$c = $meta_diff->getCell($x, $y);
					#coopy/TableDiff.hx:658: lines 658-660
					if ($x === 1) {
						#coopy/TableDiff.hx:659: characters 25-91
						$c = "@" . ($v->toString($c)??'null') . "@" . ($v->toString($meta_diff->getCell(0, $y))??'null');
					}
					#coopy/TableDiff.hx:661: characters 21-53
					$output->setCell($x - 1, $h + $y - $offset, $c);
				}

			}

			#coopy/TableDiff.hx:664: lines 664-673
			if ($this->active_column !== null) {
				#coopy/TableDiff.hx:665: lines 665-672
				if ($td->active_column->length === $meta_diff->get_width()) {
					#coopy/TableDiff.hx:667: lines 667-671
					$_g11 = 1;
					#coopy/TableDiff.hx:667: lines 667-671
					$_g4 = $meta_diff->get_width();
					#coopy/TableDiff.hx:667: lines 667-671
					while ($_g11 < $_g4) {
						#coopy/TableDiff.hx:667: lines 667-671
						$_g11 = $_g11 + 1;
						#coopy/TableDiff.hx:667: characters 26-27
						$i = $_g11 - 1;
						#coopy/TableDiff.hx:668: lines 668-670
						if (($td->active_column->arr[$i] ?? null) >= 0) {
							#coopy/TableDiff.hx:669: characters 29-51
							$this->active_column[$i - 1] = 1;
						}
					}
				}
			}
		}
		#coopy/TableDiff.hx:676: characters 9-21
		return false;
	}


	/**
	 * @param Table $output
	 * 
	 * @return int
	 */
	public function addRcNumbers ($output) {
		#coopy/TableDiff.hx:488: characters 9-31
		$admin_w = 1;
		#coopy/TableDiff.hx:489: lines 489-519
		if ($this->show_rc_numbers && !$this->flags->never_show_order) {
			#coopy/TableDiff.hx:490: characters 13-22
			$admin_w = $admin_w + 1;
			#coopy/TableDiff.hx:491: characters 13-56
			$target = new \Array_hx();
			#coopy/TableDiff.hx:492: lines 492-494
			$_g1 = 0;
			#coopy/TableDiff.hx:492: lines 492-494
			$_g = $output->get_width();
			#coopy/TableDiff.hx:492: lines 492-494
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:492: lines 492-494
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:492: characters 18-19
				$i = $_g1 - 1;
				#coopy/TableDiff.hx:493: characters 17-33
				$target->arr[$target->length] = $i + 1;
				#coopy/TableDiff.hx:493: characters 17-33
				++$target->length;

			}

			#coopy/TableDiff.hx:495: characters 13-64
			$output->insertOrDeleteColumns($target, $output->get_width() + 1);
			#coopy/TableDiff.hx:497: lines 497-504
			$_g11 = 0;
			#coopy/TableDiff.hx:497: lines 497-504
			$_g2 = $output->get_height();
			#coopy/TableDiff.hx:497: lines 497-504
			while ($_g11 < $_g2) {
				#coopy/TableDiff.hx:497: lines 497-504
				$_g11 = $_g11 + 1;
				#coopy/TableDiff.hx:497: characters 18-19
				$i1 = $_g11 - 1;
				#coopy/TableDiff.hx:498: characters 17-50
				$unit = ($this->row_map->data[$i1] ?? null);
				#coopy/TableDiff.hx:499: lines 499-502
				if ($unit === null) {
					#coopy/TableDiff.hx:500: characters 21-43
					$output->setCell(0, $i1, "");
					#coopy/TableDiff.hx:501: characters 21-29
					continue;
				}
				#coopy/TableDiff.hx:503: characters 17-61
				$output->setCell(0, $i1, $this->builder->links($unit, true));
			}

			#coopy/TableDiff.hx:505: characters 13-38
			$target = new \Array_hx();
			#coopy/TableDiff.hx:506: lines 506-508
			$_g12 = 0;
			#coopy/TableDiff.hx:506: lines 506-508
			$_g3 = $output->get_height();
			#coopy/TableDiff.hx:506: lines 506-508
			while ($_g12 < $_g3) {
				#coopy/TableDiff.hx:506: lines 506-508
				$_g12 = $_g12 + 1;
				#coopy/TableDiff.hx:506: characters 18-19
				$i2 = $_g12 - 1;
				#coopy/TableDiff.hx:507: characters 17-33
				$target->arr[$target->length] = $i2 + 1;
				#coopy/TableDiff.hx:507: characters 17-33
				++$target->length;

			}

			#coopy/TableDiff.hx:509: characters 13-62
			$output->insertOrDeleteRows($target, $output->get_height() + 1);
			#coopy/TableDiff.hx:510: lines 510-517
			$_g13 = 1;
			#coopy/TableDiff.hx:510: lines 510-517
			$_g4 = $output->get_width();
			#coopy/TableDiff.hx:510: lines 510-517
			while ($_g13 < $_g4) {
				#coopy/TableDiff.hx:510: lines 510-517
				$_g13 = $_g13 + 1;
				#coopy/TableDiff.hx:510: characters 18-19
				$i3 = $_g13 - 1;
				#coopy/TableDiff.hx:511: characters 17-52
				$unit1 = ($this->col_map->data[$i3 - 1] ?? null);
				#coopy/TableDiff.hx:512: lines 512-515
				if ($unit1 === null) {
					#coopy/TableDiff.hx:513: characters 21-43
					$output->setCell($i3, 0, "");
					#coopy/TableDiff.hx:514: characters 21-29
					continue;
				}
				#coopy/TableDiff.hx:516: characters 17-62
				$output->setCell($i3, 0, $this->builder->links($unit1, false));
			}

			#coopy/TableDiff.hx:518: characters 13-54
			$output->setCell(0, 0, $this->builder->marker("@:@"));
		}
		#coopy/TableDiff.hx:520: characters 9-23
		return $admin_w;
	}


	/**
	 * @param Table $output
	 * 
	 * @return void
	 */
	public function addSchema ($output) {
		#coopy/TableDiff.hx:562: lines 562-570
		if ($this->have_schema) {
			#coopy/TableDiff.hx:563: characters 13-42
			$at = $output->get_height();
			#coopy/TableDiff.hx:564: characters 13-54
			$output->resize($this->column_units->length + 1, $at + 1);
			#coopy/TableDiff.hx:565: characters 13-53
			$output->setCell(0, $at, $this->builder->marker("!"));
			#coopy/TableDiff.hx:566: lines 566-568
			$_g1 = 0;
			#coopy/TableDiff.hx:566: lines 566-568
			$_g = $this->column_units->length;
			#coopy/TableDiff.hx:566: lines 566-568
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:566: lines 566-568
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:566: characters 18-19
				$j = $_g1 - 1;
				#coopy/TableDiff.hx:567: characters 17-60
				$output->setCell($j + 1, $at, $this->v->toDatum(($this->schema->arr[$j] ?? null)));
			}

			#coopy/TableDiff.hx:569: characters 13-37
			$this->schema_diff_found = true;
		}
	}


	/**
	 * @param Table $t
	 * @param Table $meta
	 * 
	 * @return bool
	 */
	public function checkMeta ($t, $meta) {
		#coopy/TableDiff.hx:603: lines 603-605
		if ($meta === null) {
			#coopy/TableDiff.hx:604: characters 13-25
			return false;
		}
		#coopy/TableDiff.hx:606: lines 606-608
		if ($t === null) {
			#coopy/TableDiff.hx:607: characters 20-53
			if ($meta->get_width() === 1) {
				#coopy/TableDiff.hx:607: characters 38-52
				return $meta->get_height() === 1;
			} else {
				#coopy/TableDiff.hx:607: characters 20-53
				return false;
			}
		}
		#coopy/TableDiff.hx:609: characters 9-48
		if ($meta->get_width() !== ($t->get_width() + 1)) {
			#coopy/TableDiff.hx:609: characters 36-48
			return false;
		}
		#coopy/TableDiff.hx:610: characters 9-56
		if (($meta->get_width() === 0) || ($meta->get_height() === 0)) {
			#coopy/TableDiff.hx:610: characters 44-56
			return false;
		}
		#coopy/TableDiff.hx:611: characters 9-20
		return true;
	}


	/**
	 * @param View $v
	 * @param bool $have_ll
	 * @param mixed $ll
	 * @param bool $have_rr
	 * @param mixed $rr
	 * @param bool $have_pp
	 * @param mixed $pp
	 * @param int $x
	 * @param int $y
	 * 
	 * @return \Array_hx
	 */
	public function checkNesting ($v, $have_ll, $ll, $have_rr, $rr, $have_pp, $pp, $x, $y) {
		#coopy/TableDiff.hx:719: characters 9-31
		$all_tables = true;
		#coopy/TableDiff.hx:720: characters 9-62
		if ($have_ll) {
			#coopy/TableDiff.hx:720: characters 49-62
			$all_tables = $all_tables && $v->isTable($ll);
		}
		#coopy/TableDiff.hx:721: characters 9-62
		if ($have_rr) {
			#coopy/TableDiff.hx:721: characters 49-62
			$all_tables = $all_tables && $v->isTable($rr);
		}
		#coopy/TableDiff.hx:722: characters 9-62
		if ($have_pp) {
			#coopy/TableDiff.hx:722: characters 49-62
			$all_tables = $all_tables && $v->isTable($pp);
		}
		#coopy/TableDiff.hx:723: characters 9-43
		if (!$all_tables) {
			#coopy/TableDiff.hx:723: characters 26-43
			return \Array_hx::wrap([
				$ll,
				$rr,
				$pp,
			]);
		}
		#coopy/TableDiff.hx:725: characters 9-37
		$ll_table = null;
		#coopy/TableDiff.hx:726: characters 9-37
		$rr_table = null;
		#coopy/TableDiff.hx:727: characters 9-37
		$pp_table = null;
		#coopy/TableDiff.hx:728: characters 9-47
		if ($have_ll) {
			#coopy/TableDiff.hx:728: characters 22-47
			$ll_table = $v->getTable($ll);
		}
		#coopy/TableDiff.hx:729: characters 9-47
		if ($have_rr) {
			#coopy/TableDiff.hx:729: characters 22-47
			$rr_table = $v->getTable($rr);
		}
		#coopy/TableDiff.hx:730: characters 9-47
		if ($have_pp) {
			#coopy/TableDiff.hx:730: characters 22-47
			$pp_table = $v->getTable($pp);
		}
		#coopy/TableDiff.hx:731: characters 9-29
		$compare = false;
		#coopy/TableDiff.hx:732: characters 9-47
		$comp = new TableComparisonState();
		#coopy/TableDiff.hx:733: characters 9-26
		$comp->a = $ll_table;
		#coopy/TableDiff.hx:734: characters 9-26
		$comp->b = $rr_table;
		#coopy/TableDiff.hx:735: characters 9-26
		$comp->p = $pp_table;
		#coopy/TableDiff.hx:736: characters 9-35
		$comp->compare_flags = $this->flags;
		#coopy/TableDiff.hx:737: characters 9-23
		$comp->getMeta();
		#coopy/TableDiff.hx:738: characters 9-24
		$key = null;
		#coopy/TableDiff.hx:739: lines 739-741
		if ($comp->a_meta !== null) {
			#coopy/TableDiff.hx:740: characters 13-40
			$key = $comp->a_meta->getName();
		}
		#coopy/TableDiff.hx:742: lines 742-744
		if (($key === null) && ($comp->b_meta !== null)) {
			#coopy/TableDiff.hx:743: characters 13-40
			$key = $comp->b_meta->getName();
		}
		#coopy/TableDiff.hx:745: lines 745-747
		if ($key === null) {
			#coopy/TableDiff.hx:746: characters 13-30
			$key = ($x??'null') . "_" . ($y??'null');
		}
		#coopy/TableDiff.hx:748: lines 748-756
		if ($this->align->comp !== null) {
			#coopy/TableDiff.hx:749: lines 749-755
			if ($this->align->comp->children === null) {
				#coopy/TableDiff.hx:750: characters 17-78
				$this->align->comp->children = new StringMap();
				#coopy/TableDiff.hx:751: characters 17-61
				$this->align->comp->child_order = new \Array_hx();
				#coopy/TableDiff.hx:752: characters 17-31
				$compare = true;
			} else {
				#coopy/TableDiff.hx:754: characters 17-59
				$compare = !array_key_exists($key, $this->align->comp->children->data);
			}
		}
		#coopy/TableDiff.hx:757: lines 757-765
		if ($compare) {
			#coopy/TableDiff.hx:758: characters 13-35
			$this->nesting_present = true;
			#coopy/TableDiff.hx:759: characters 13-46
			$this->align->comp->children->data[$key] = $comp;
			#coopy/TableDiff.hx:760: characters 13-45
			$_this = $this->align->comp->child_order;
			#coopy/TableDiff.hx:760: characters 13-45
			$_this->arr[$_this->length] = $key;
			#coopy/TableDiff.hx:760: characters 13-45
			++$_this->length;

			#coopy/TableDiff.hx:761: characters 13-45
			$ct = new CompareTable($comp);
			#coopy/TableDiff.hx:762: characters 13-23
			$ct->align();
		} else {
			#coopy/TableDiff.hx:764: characters 20-48
			$comp = ($this->align->comp->children->data[$key] ?? null);
		}
		#coopy/TableDiff.hx:767: characters 9-36
		$ll_out = null;
		#coopy/TableDiff.hx:768: characters 9-36
		$rr_out = null;
		#coopy/TableDiff.hx:769: characters 9-36
		$pp_out = null;
		#coopy/TableDiff.hx:770: lines 770-784
		if ($comp->alignment->isMarkedAsIdentical() || ($have_ll && !$have_rr) || ($have_rr && !$have_ll)) {
			#coopy/TableDiff.hx:771: characters 13-37
			$ll_out = "[" . ($key??'null') . "]";
			#coopy/TableDiff.hx:772: characters 13-28
			$rr_out = $ll_out;
			#coopy/TableDiff.hx:773: characters 13-28
			$pp_out = $ll_out;
		} else {
			#coopy/TableDiff.hx:775: lines 775-777
			if ($ll !== null) {
				#coopy/TableDiff.hx:776: characters 17-43
				$ll_out = "[a." . ($key??'null') . "]";
			}
			#coopy/TableDiff.hx:778: lines 778-780
			if ($rr !== null) {
				#coopy/TableDiff.hx:779: characters 17-43
				$rr_out = "[b." . ($key??'null') . "]";
			}
			#coopy/TableDiff.hx:781: lines 781-783
			if ($pp !== null) {
				#coopy/TableDiff.hx:782: characters 17-43
				$pp_out = "[p." . ($key??'null') . "]";
			}
		}
		#coopy/TableDiff.hx:785: characters 9-40
		return \Array_hx::wrap([
			$ll_out,
			$rr_out,
			$pp_out,
		]);
	}


	/**
	 * @param int $w
	 * @param int $h
	 * 
	 * @return void
	 */
	public function checkRcNumbers ($w, $h) {
		#coopy/TableDiff.hx:475: lines 475-484
		if (!$this->show_rc_numbers) {
			#coopy/TableDiff.hx:476: lines 476-483
			if ($this->flags->always_show_order) {
				#coopy/TableDiff.hx:477: characters 17-39
				$this->show_rc_numbers = true;
			} else if ($this->flags->ordered) {
				#coopy/TableDiff.hx:479: characters 17-57
				$this->show_rc_numbers = $this->isReordered($this->row_map, $h);
				#coopy/TableDiff.hx:480: lines 480-482
				if (!$this->show_rc_numbers) {
					#coopy/TableDiff.hx:481: characters 21-61
					$this->show_rc_numbers = $this->isReordered($this->col_map, $w);
				}
			}
		}
	}


	/**
	 * @param \Array_hx $active
	 * 
	 * @return int
	 */
	public function countActive ($active) {
		#coopy/TableDiff.hx:245: characters 9-20
		$ct = 0;
		#coopy/TableDiff.hx:246: characters 9-34
		$showed_dummy = false;
		#coopy/TableDiff.hx:247: lines 247-254
		$_g1 = 0;
		#coopy/TableDiff.hx:247: lines 247-254
		$_g = $active->length;
		#coopy/TableDiff.hx:247: lines 247-254
		while ($_g1 < $_g) {
			#coopy/TableDiff.hx:247: lines 247-254
			$_g1 = $_g1 + 1;
			#coopy/TableDiff.hx:247: characters 14-15
			$i = $_g1 - 1;
			#coopy/TableDiff.hx:248: characters 13-39
			$publish = ($active->arr[$i] ?? null) > 0;
			#coopy/TableDiff.hx:249: characters 13-38
			$dummy = ($active->arr[$i] ?? null) === 3;
			#coopy/TableDiff.hx:250: characters 13-46
			if ($dummy && $showed_dummy) {
				#coopy/TableDiff.hx:250: characters 38-46
				continue;
			}
			#coopy/TableDiff.hx:251: characters 13-35
			if (!$publish) {
				#coopy/TableDiff.hx:251: characters 27-35
				continue;
			}
			#coopy/TableDiff.hx:252: characters 13-33
			$showed_dummy = $dummy;
			#coopy/TableDiff.hx:253: characters 13-17
			$ct = $ct + 1;
		}

		#coopy/TableDiff.hx:255: characters 9-18
		return $ct;
	}


	/**
	 * @param Table $output
	 * @param int $admin_w
	 * 
	 * @return void
	 */
	public function elideColumns ($output, $admin_w) {
		#coopy/TableDiff.hx:524: lines 524-558
		if ($this->active_column !== null) {
			#coopy/TableDiff.hx:525: characters 13-42
			$all_active = true;
			#coopy/TableDiff.hx:526: lines 526-531
			$_g1 = 0;
			#coopy/TableDiff.hx:526: lines 526-531
			$_g = $this->active_column->length;
			#coopy/TableDiff.hx:526: lines 526-531
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:526: lines 526-531
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:526: characters 18-19
				$i = $_g1 - 1;
				#coopy/TableDiff.hx:527: lines 527-530
				if (($this->active_column->arr[$i] ?? null) === 0) {
					#coopy/TableDiff.hx:528: characters 21-39
					$all_active = false;
					#coopy/TableDiff.hx:529: characters 21-26
					break;
				}
			}

			#coopy/TableDiff.hx:532: lines 532-557
			if (!$all_active) {
				#coopy/TableDiff.hx:533: characters 17-58
				$fate = new \Array_hx();
				#coopy/TableDiff.hx:534: lines 534-536
				$_g11 = 0;
				#coopy/TableDiff.hx:534: lines 534-536
				$_g2 = $admin_w;
				#coopy/TableDiff.hx:534: lines 534-536
				while ($_g11 < $_g2) {
					#coopy/TableDiff.hx:534: lines 534-536
					$_g11 = $_g11 + 1;
					#coopy/TableDiff.hx:534: characters 22-23
					$i1 = $_g11 - 1;
					#coopy/TableDiff.hx:535: characters 21-33
					$fate->arr[$fate->length] = $i1;
					#coopy/TableDiff.hx:535: characters 21-33
					++$fate->length;

				}

				#coopy/TableDiff.hx:537: characters 17-40
				$at = $admin_w;
				#coopy/TableDiff.hx:538: characters 17-34
				$ct = 0;
				#coopy/TableDiff.hx:539: characters 17-58
				$dots = new \Array_hx();
				#coopy/TableDiff.hx:540: lines 540-550
				$_g12 = 0;
				#coopy/TableDiff.hx:540: lines 540-550
				$_g3 = $this->active_column->length;
				#coopy/TableDiff.hx:540: lines 540-550
				while ($_g12 < $_g3) {
					#coopy/TableDiff.hx:540: lines 540-550
					$_g12 = $_g12 + 1;
					#coopy/TableDiff.hx:540: characters 22-23
					$i2 = $_g12 - 1;
					#coopy/TableDiff.hx:541: characters 21-60
					$off = ($this->active_column->arr[$i2] ?? null) === 0;
					#coopy/TableDiff.hx:542: characters 32-38
					$ct = ($off ? $ct + 1 : 0);
					#coopy/TableDiff.hx:543: lines 543-549
					if ($off && ($ct > 1)) {
						#coopy/TableDiff.hx:544: characters 25-38
						$fate->arr[$fate->length] = -1;
						#coopy/TableDiff.hx:544: characters 25-38
						++$fate->length;
					} else {
						#coopy/TableDiff.hx:546: characters 25-47
						if ($off) {
							#coopy/TableDiff.hx:546: characters 34-47
							$dots->arr[$dots->length] = $at;
							#coopy/TableDiff.hx:546: characters 34-47
							++$dots->length;
						}
						#coopy/TableDiff.hx:547: characters 25-38
						$fate->arr[$fate->length] = $at;
						#coopy/TableDiff.hx:547: characters 25-38
						++$fate->length;

						#coopy/TableDiff.hx:548: characters 25-29
						$at = $at + 1;
					}
				}

				#coopy/TableDiff.hx:551: characters 17-54
				$output->insertOrDeleteColumns($fate, $at);
				#coopy/TableDiff.hx:552: lines 552-556
				$_g4 = 0;
				#coopy/TableDiff.hx:552: lines 552-556
				while ($_g4 < $dots->length) {
					#coopy/TableDiff.hx:552: characters 22-23
					$d = ($dots->arr[$_g4] ?? null);
					#coopy/TableDiff.hx:552: lines 552-556
					$_g4 = $_g4 + 1;
					#coopy/TableDiff.hx:553: lines 553-555
					$_g21 = 0;
					#coopy/TableDiff.hx:553: lines 553-555
					$_g13 = $output->get_height();
					#coopy/TableDiff.hx:553: lines 553-555
					while ($_g21 < $_g13) {
						#coopy/TableDiff.hx:553: lines 553-555
						$_g21 = $_g21 + 1;
						#coopy/TableDiff.hx:553: characters 26-27
						$j = $_g21 - 1;
						#coopy/TableDiff.hx:554: characters 25-66
						$output->setCell($d, $j, $this->builder->marker("..."));
					}

				}

			}
		}
	}


	/**
	 * @return TableComparisonState
	 */
	public function getComparisonState () {
		#coopy/TableDiff.hx:1168: characters 9-37
		if ($this->align === null) {
			#coopy/TableDiff.hx:1168: characters 26-37
			return null;
		}
		#coopy/TableDiff.hx:1169: characters 9-26
		return $this->align->comp;
	}


	/**
	 * @param Table $t
	 * 
	 * @return Table
	 */
	public function getMetaTable ($t) {
		#coopy/TableDiff.hx:615: lines 615-619
		if ($t === null) {
			#coopy/TableDiff.hx:616: characters 13-47
			$result = new SimpleTable(1, 1);
			#coopy/TableDiff.hx:617: characters 13-36
			$result->setCell(0, 0, "@");
			#coopy/TableDiff.hx:618: characters 13-26
			return $result;
		}
		#coopy/TableDiff.hx:620: characters 9-32
		$meta = $t->getMeta();
		#coopy/TableDiff.hx:621: characters 9-36
		if ($meta === null) {
			#coopy/TableDiff.hx:621: characters 25-36
			return null;
		}
		#coopy/TableDiff.hx:622: characters 9-30
		return $meta->asTable();
	}


	/**
	 * @param Table $t
	 * @param Table $t2
	 * @param string $root
	 * 
	 * @return string
	 */
	public function getSeparator ($t, $t2, $root) {
		#coopy/TableDiff.hx:109: characters 9-33
		$sep = $root;
		#coopy/TableDiff.hx:110: characters 9-31
		$w = $t->get_width();
		#coopy/TableDiff.hx:111: characters 9-32
		$h = $t->get_height();
		#coopy/TableDiff.hx:112: characters 9-43
		$view = $t->getCellView();
		#coopy/TableDiff.hx:113: lines 113-121
		$_g1 = 0;
		#coopy/TableDiff.hx:113: lines 113-121
		$_g = $h;
		#coopy/TableDiff.hx:113: lines 113-121
		while ($_g1 < $_g) {
			#coopy/TableDiff.hx:113: lines 113-121
			$_g1 = $_g1 + 1;
			#coopy/TableDiff.hx:113: characters 14-15
			$y = $_g1 - 1;
			#coopy/TableDiff.hx:114: lines 114-120
			$_g3 = 0;
			#coopy/TableDiff.hx:114: lines 114-120
			$_g2 = $w;
			#coopy/TableDiff.hx:114: lines 114-120
			while ($_g3 < $_g2) {
				#coopy/TableDiff.hx:114: lines 114-120
				$_g3 = $_g3 + 1;
				#coopy/TableDiff.hx:114: characters 18-19
				$x = $_g3 - 1;
				#coopy/TableDiff.hx:115: characters 17-66
				$txt = $view->toString($t->getCell($x, $y));
				#coopy/TableDiff.hx:116: characters 17-40
				if ($txt === null) {
					#coopy/TableDiff.hx:116: characters 32-40
					continue;
				}
				#coopy/TableDiff.hx:117: lines 117-119
				while (HxString::indexOf($txt, $sep) >= 0) {
					#coopy/TableDiff.hx:118: characters 21-36
					$sep = "-" . ($sep??'null');
				}
			}

		}

		#coopy/TableDiff.hx:122: lines 122-134
		if ($t2 !== null) {
			#coopy/TableDiff.hx:123: characters 13-25
			$w = $t2->get_width();
			#coopy/TableDiff.hx:124: characters 13-26
			$h = $t2->get_height();
			#coopy/TableDiff.hx:125: lines 125-133
			$_g11 = 0;
			#coopy/TableDiff.hx:125: lines 125-133
			$_g4 = $h;
			#coopy/TableDiff.hx:125: lines 125-133
			while ($_g11 < $_g4) {
				#coopy/TableDiff.hx:125: lines 125-133
				$_g11 = $_g11 + 1;
				#coopy/TableDiff.hx:125: characters 18-19
				$y1 = $_g11 - 1;
				#coopy/TableDiff.hx:126: lines 126-132
				$_g31 = 0;
				#coopy/TableDiff.hx:126: lines 126-132
				$_g21 = $w;
				#coopy/TableDiff.hx:126: lines 126-132
				while ($_g31 < $_g21) {
					#coopy/TableDiff.hx:126: lines 126-132
					$_g31 = $_g31 + 1;
					#coopy/TableDiff.hx:126: characters 22-23
					$x1 = $_g31 - 1;
					#coopy/TableDiff.hx:127: characters 21-71
					$txt1 = $view->toString($t2->getCell($x1, $y1));
					#coopy/TableDiff.hx:128: characters 21-44
					if ($txt1 === null) {
						#coopy/TableDiff.hx:128: characters 36-44
						continue;
					}
					#coopy/TableDiff.hx:129: lines 129-131
					while (HxString::indexOf($txt1, $sep) >= 0) {
						#coopy/TableDiff.hx:130: characters 25-40
						$sep = "-" . ($sep??'null');
					}
				}

			}

		}
		#coopy/TableDiff.hx:135: characters 9-19
		return $sep;
	}


	/**
	 * @return DiffSummary
	 */
	public function getSummary () {
		#coopy/TableDiff.hx:1179: characters 9-36
		$ds = new DiffSummary();
		#coopy/TableDiff.hx:1180: characters 9-37
		$ds->row_deletes = $this->row_deletes;
		#coopy/TableDiff.hx:1181: characters 9-37
		$ds->row_inserts = $this->row_inserts;
		#coopy/TableDiff.hx:1182: characters 9-37
		$ds->row_updates = $this->row_updates;
		#coopy/TableDiff.hx:1183: characters 9-39
		$ds->row_reorders = $this->row_reorders;
		#coopy/TableDiff.hx:1184: characters 9-37
		$ds->col_deletes = $this->col_deletes;
		#coopy/TableDiff.hx:1185: characters 9-37
		$ds->col_inserts = $this->col_inserts;
		#coopy/TableDiff.hx:1186: characters 9-37
		$ds->col_updates = $this->col_updates;
		#coopy/TableDiff.hx:1187: characters 9-37
		$ds->col_renames = $this->col_renames;
		#coopy/TableDiff.hx:1188: characters 9-39
		$ds->col_reorders = $this->col_reorders;
		#coopy/TableDiff.hx:1189: characters 9-68
		$ds->row_count_initial_with_header = $this->align->getSource()->get_height();
		#coopy/TableDiff.hx:1190: characters 9-66
		$ds->row_count_final_with_header = $this->align->getTarget()->get_height();
		#coopy/TableDiff.hx:1191: characters 9-86
		$ds->row_count_initial = $this->align->getSource()->get_height() - $this->align->getSourceHeader() - 1;
		#coopy/TableDiff.hx:1192: characters 9-84
		$ds->row_count_final = $this->align->getTarget()->get_height() - $this->align->getTargetHeader() - 1;
		#coopy/TableDiff.hx:1193: characters 9-55
		$ds->col_count_initial = $this->align->getSource()->get_width();
		#coopy/TableDiff.hx:1194: characters 9-53
		$ds->col_count_final = $this->align->getTarget()->get_width();
		#coopy/TableDiff.hx:1195: lines 1195-1197
		$ds->different = ($this->row_deletes + $this->row_inserts + $this->row_updates + $this->row_reorders + $this->col_deletes + $this->col_inserts + $this->col_updates + $this->col_renames + $this->col_reorders) > 0;
		#coopy/TableDiff.hx:1198: characters 9-18
		return $ds;
	}


	/**
	 * @return bool
	 */
	public function hasDifference () {
		#coopy/TableDiff.hx:1151: characters 9-26
		return $this->diff_found;
	}


	/**
	 * @return bool
	 */
	public function hasSchemaDifference () {
		#coopy/TableDiff.hx:1160: characters 9-33
		return $this->schema_diff_found;
	}


	/**
	 * @param Table $output
	 * 
	 * @return bool
	 */
	public function hilite ($output) {
		#coopy/TableDiff.hx:982: characters 9-39
		$output = Coopy::tablify($output);
		#coopy/TableDiff.hx:983: characters 9-36
		return $this->hiliteSingle($output);
	}


	/**
	 * @param Table $output
	 * 
	 * @return bool
	 */
	public function hiliteSingle ($output) {
		#coopy/TableDiff.hx:987: characters 9-48
		if (!$output->isResizable()) {
			#coopy/TableDiff.hx:987: characters 36-48
			return false;
		}
		#coopy/TableDiff.hx:988: lines 988-994
		if ($this->builder === null) {
			#coopy/TableDiff.hx:989: lines 989-993
			if ($this->flags->allow_nested_cells) {
				#coopy/TableDiff.hx:990: characters 17-50
				$this->builder = new NestedCellBuilder();
			} else {
				#coopy/TableDiff.hx:992: characters 17-53
				$this->builder = new FlatCellBuilder($this->flags);
			}
		}
		#coopy/TableDiff.hx:995: characters 9-27
		$output->resize(0, 0);
		#coopy/TableDiff.hx:996: characters 9-23
		$output->clear();
		#coopy/TableDiff.hx:998: characters 9-16
		$this->reset();
		#coopy/TableDiff.hx:999: characters 9-22
		$this->setupTables();
		#coopy/TableDiff.hx:1000: characters 9-23
		$this->setupColumns();
		#coopy/TableDiff.hx:1001: characters 9-21
		$this->setupMoves();
		#coopy/TableDiff.hx:1002: characters 9-23
		$this->scanActivity();
		#coopy/TableDiff.hx:1003: characters 9-21
		$this->scanSchema();
		#coopy/TableDiff.hx:1004: characters 9-26
		$this->addSchema($output);
		#coopy/TableDiff.hx:1005: characters 9-26
		$this->addHeader($output);
		#coopy/TableDiff.hx:1006: characters 9-24
		$this->addMeta($output);
		#coopy/TableDiff.hx:1011: lines 1011-1012
		$outer_reps_needed = ($this->flags->show_unchanged && $this->flags->show_unchanged_columns ? 1 : 2);
		#coopy/TableDiff.hx:1018: characters 9-30
		$outer_reps_needed = 2;
		#coopy/TableDiff.hx:1021: characters 9-49
		$output_height = $output->get_height();
		#coopy/TableDiff.hx:1022: characters 9-54
		$output_height_init = $output->get_height();
		#coopy/TableDiff.hx:1024: lines 1024-1111
		$_g1 = 0;
		#coopy/TableDiff.hx:1024: lines 1024-1111
		$_g = $outer_reps_needed;
		#coopy/TableDiff.hx:1024: lines 1024-1111
		while ($_g1 < $_g) {
			#coopy/TableDiff.hx:1024: lines 1024-1111
			$_g1 = $_g1 + 1;
			#coopy/TableDiff.hx:1024: characters 14-17
			$out = $_g1 - 1;
			#coopy/TableDiff.hx:1025: lines 1025-1033
			if ($out === 1) {
				#coopy/TableDiff.hx:1026: characters 17-33
				$this->refineActivity();
				#coopy/TableDiff.hx:1027: characters 17-77
				$rows = $this->countActive($this->active_row) + $output_height_init;
				#coopy/TableDiff.hx:1028: characters 17-42
				if ($this->top_line_done) {
					#coopy/TableDiff.hx:1028: characters 36-42
					$rows = $rows - 1;
				}
				#coopy/TableDiff.hx:1029: characters 17-51
				$output_height = $output_height_init;
				#coopy/TableDiff.hx:1030: lines 1030-1032
				if ($rows > $output->get_height()) {
					#coopy/TableDiff.hx:1031: characters 21-62
					$output->resize($this->column_units->length + 1, $rows);
				}
			}
			#coopy/TableDiff.hx:1035: characters 13-45
			$showed_dummy = false;
			#coopy/TableDiff.hx:1036: characters 13-30
			$l = -1;
			#coopy/TableDiff.hx:1037: characters 13-30
			$r = -1;
			#coopy/TableDiff.hx:1038: lines 1038-1110
			$_g3 = 0;
			#coopy/TableDiff.hx:1038: lines 1038-1110
			$_g2 = $this->row_units->length;
			#coopy/TableDiff.hx:1038: lines 1038-1110
			while ($_g3 < $_g2) {
				#coopy/TableDiff.hx:1038: lines 1038-1110
				$_g3 = $_g3 + 1;
				#coopy/TableDiff.hx:1038: characters 18-19
				$i = $_g3 - 1;
				#coopy/TableDiff.hx:1039: characters 17-48
				$unit = ($this->row_units->arr[$i] ?? null);
				#coopy/TableDiff.hx:1040: characters 17-46
				$reordered = false;
				#coopy/TableDiff.hx:1042: lines 1042-1047
				if ($this->flags->ordered) {
					#coopy/TableDiff.hx:1043: lines 1043-1045
					if (array_key_exists($i, $this->row_moves->data)) {
						#coopy/TableDiff.hx:1044: characters 25-41
						$reordered = true;
					}
					#coopy/TableDiff.hx:1046: characters 21-58
					if ($reordered) {
						#coopy/TableDiff.hx:1046: characters 36-58
						$this->show_rc_numbers = true;
					}
				}
				#coopy/TableDiff.hx:1049: characters 17-51
				if (($unit->r < 0) && ($unit->l < 0)) {
					#coopy/TableDiff.hx:1049: characters 43-51
					continue;
				}
				#coopy/TableDiff.hx:1051: characters 17-73
				if (($unit->r === 0) && ($unit->lp() <= 0) && $this->top_line_done) {
					#coopy/TableDiff.hx:1051: characters 65-73
					continue;
				}
				#coopy/TableDiff.hx:1053: characters 17-47
				$this->publish = $this->flags->show_unchanged;
				#coopy/TableDiff.hx:1054: characters 17-42
				$dummy = false;
				#coopy/TableDiff.hx:1055: lines 1055-1061
				if ($out === 1) {
					#coopy/TableDiff.hx:1056: characters 21-58
					$value = ($this->active_row->arr[$i] ?? null);
					#coopy/TableDiff.hx:1057: characters 21-53
					$this->publish = ($value !== null) && ($value > 0);
					#coopy/TableDiff.hx:1058: characters 44-52
					$dummy = ($value !== null) && ($value === 3);
					#coopy/TableDiff.hx:1059: characters 21-54
					if ($dummy && $showed_dummy) {
						#coopy/TableDiff.hx:1059: characters 46-54
						continue;
					}
					#coopy/TableDiff.hx:1060: characters 21-43
					if (!$this->publish) {
						#coopy/TableDiff.hx:1060: characters 35-43
						continue;
					}
				}
				#coopy/TableDiff.hx:1063: characters 17-49
				if (!$dummy) {
					#coopy/TableDiff.hx:1063: characters 29-49
					$showed_dummy = false;
				}
				#coopy/TableDiff.hx:1065: characters 17-46
				$at = $output_height;
				#coopy/TableDiff.hx:1066: lines 1066-1071
				if ($this->publish) {
					#coopy/TableDiff.hx:1067: characters 21-36
					$output_height = $output_height + 1;
					#coopy/TableDiff.hx:1068: lines 1068-1070
					if ($output->get_height() < $output_height) {
						#coopy/TableDiff.hx:1069: characters 25-75
						$output->resize($this->column_units->length + 1, $output_height);
					}
				}
				#coopy/TableDiff.hx:1072: lines 1072-1078
				if ($dummy) {
					#coopy/TableDiff.hx:1073: lines 1073-1075
					$_g5 = 0;
					#coopy/TableDiff.hx:1073: lines 1073-1075
					$_g4 = $this->column_units->length + 1;
					#coopy/TableDiff.hx:1073: lines 1073-1075
					while ($_g5 < $_g4) {
						#coopy/TableDiff.hx:1073: lines 1073-1075
						$_g5 = $_g5 + 1;
						#coopy/TableDiff.hx:1073: characters 26-27
						$j = $_g5 - 1;
						#coopy/TableDiff.hx:1074: characters 25-62
						$output->setCell($j, $at, $this->v->toDatum("..."));
					}

					#coopy/TableDiff.hx:1076: characters 21-40
					$showed_dummy = true;
					#coopy/TableDiff.hx:1077: characters 21-29
					continue;
				}
				#coopy/TableDiff.hx:1080: characters 17-38
				$this->have_addition = false;
				#coopy/TableDiff.hx:1081: characters 17-41
				$skip = false;
				#coopy/TableDiff.hx:1083: characters 17-25
				$this->act = "";
				#coopy/TableDiff.hx:1084: lines 1084-1087
				if ($reordered) {
					#coopy/TableDiff.hx:1085: characters 21-30
					$this->act = ":";
					#coopy/TableDiff.hx:1086: characters 21-47
					if ($out === 0) {
						#coopy/TableDiff.hx:1086: characters 33-47
						$this->row_reorders++;
					}
				}
				#coopy/TableDiff.hx:1089: lines 1089-1093
				if (($unit->p < 0) && ($unit->l < 0) && ($unit->r >= 0)) {
					#coopy/TableDiff.hx:1090: characters 21-51
					if (!$this->allow_insert) {
						#coopy/TableDiff.hx:1090: characters 40-51
						$skip = true;
					}
					#coopy/TableDiff.hx:1091: characters 21-32
					$this->act = "+++";
					#coopy/TableDiff.hx:1092: characters 21-55
					if (($out === 0) && !$skip) {
						#coopy/TableDiff.hx:1092: characters 42-55
						$this->row_inserts++;
					}
				}
				#coopy/TableDiff.hx:1094: lines 1094-1098
				if ((($unit->p >= 0) || !$this->has_parent) && ($unit->l >= 0) && ($unit->r < 0)) {
					#coopy/TableDiff.hx:1095: characters 21-51
					if (!$this->allow_delete) {
						#coopy/TableDiff.hx:1095: characters 40-51
						$skip = true;
					}
					#coopy/TableDiff.hx:1096: characters 21-32
					$this->act = "---";
					#coopy/TableDiff.hx:1097: characters 21-55
					if (($out === 0) && !$skip) {
						#coopy/TableDiff.hx:1097: characters 42-55
						$this->row_deletes++;
					}
				}
				#coopy/TableDiff.hx:1100: lines 1100-1107
				if ($skip) {
					#coopy/TableDiff.hx:1101: lines 1101-1105
					if (!$this->publish) {
						#coopy/TableDiff.hx:1102: lines 1102-1104
						if ($this->active_row !== null) {
							#coopy/TableDiff.hx:1103: characters 29-47
							$this->active_row[$i] = -3;
						}
					}
					#coopy/TableDiff.hx:1106: characters 21-29
					continue;
				}
				#coopy/TableDiff.hx:1109: characters 17-46
				$this->scanRow($unit, $output, $at, $i, $out);
			}

		}

		#coopy/TableDiff.hx:1113: characters 9-51
		$this->checkRcNumbers($output->get_width(), $output->get_height());
		#coopy/TableDiff.hx:1115: characters 9-50
		$admin_w = $this->addRcNumbers($output);
		#coopy/TableDiff.hx:1116: characters 9-60
		if (!$this->preserve_columns) {
			#coopy/TableDiff.hx:1116: characters 32-60
			$this->elideColumns($output, $admin_w);
		}
		#coopy/TableDiff.hx:1118: characters 9-20
		return true;
	}


	/**
	 * @param Tables $output
	 * 
	 * @return bool
	 */
	public function hiliteWithNesting ($output) {
		#coopy/TableDiff.hx:1124: characters 9-39
		$base = $output->add("base");
		#coopy/TableDiff.hx:1125: characters 9-41
		$result = $this->hiliteSingle($base);
		#coopy/TableDiff.hx:1126: characters 9-34
		if (!$result) {
			#coopy/TableDiff.hx:1126: characters 22-34
			return false;
		}
		#coopy/TableDiff.hx:1127: characters 9-42
		if ($this->align->comp === null) {
			#coopy/TableDiff.hx:1127: characters 31-42
			return true;
		}
		#coopy/TableDiff.hx:1128: characters 9-44
		$order = $this->align->comp->child_order;
		#coopy/TableDiff.hx:1129: characters 9-37
		if ($order === null) {
			#coopy/TableDiff.hx:1129: characters 26-37
			return true;
		}
		#coopy/TableDiff.hx:1130: characters 9-33
		$output->alignment = $this->align;
		#coopy/TableDiff.hx:1131: lines 1131-1141
		$_g = 0;
		#coopy/TableDiff.hx:1131: lines 1131-1141
		while ($_g < $order->length) {
			#coopy/TableDiff.hx:1131: characters 14-18
			$name = ($order->arr[$_g] ?? null);
			#coopy/TableDiff.hx:1131: lines 1131-1141
			$_g = $_g + 1;
			#coopy/TableDiff.hx:1132: characters 13-55
			$child = ($this->align->comp->children->data[$name] ?? null);
			#coopy/TableDiff.hx:1133: characters 13-45
			$alignment = $child->alignment;
			#coopy/TableDiff.hx:1134: lines 1134-1137
			if ($alignment->isMarkedAsIdentical()) {
				#coopy/TableDiff.hx:1135: characters 17-51
				$this->align->comp->children->data[$name] = null;
				#coopy/TableDiff.hx:1136: characters 17-25
				continue;
			}
			#coopy/TableDiff.hx:1138: characters 13-53
			$td = new TableDiff($alignment, $this->flags);
			#coopy/TableDiff.hx:1139: characters 13-49
			$child_output = $output->add($name);
			#coopy/TableDiff.hx:1140: characters 32-61
			$result = $result && $td->hiliteSingle($child_output);
		}

		#coopy/TableDiff.hx:1142: characters 9-22
		return $result;
	}


	/**
	 * @param View $v
	 * @param mixed $aa
	 * @param mixed $bb
	 * 
	 * @return bool
	 */
	public function isEqual ($v, $aa, $bb) {
		#coopy/TableDiff.hx:708: lines 708-710
		if ($this->flags->ignore_whitespace || $this->flags->ignore_case) {
			#coopy/TableDiff.hx:709: characters 13-66
			return $this->normalizeString($v, $aa) === $this->normalizeString($v, $bb);
		}
		#coopy/TableDiff.hx:711: characters 9-31
		return $v->equals($aa, $bb);
	}


	/**
	 * @return bool
	 */
	public function isNested () {
		#coopy/TableDiff.hx:1164: characters 9-31
		return $this->nesting_present;
	}


	/**
	 * @param IntMap $m
	 * @param int $ct
	 * 
	 * @return bool
	 */
	public function isReordered ($m, $ct) {
		#coopy/TableDiff.hx:156: characters 9-38
		$reordered = false;
		#coopy/TableDiff.hx:157: characters 9-26
		$l = -1;
		#coopy/TableDiff.hx:158: characters 9-26
		$r = -1;
		#coopy/TableDiff.hx:159: lines 159-176
		$_g1 = 0;
		#coopy/TableDiff.hx:159: lines 159-176
		$_g = $ct;
		#coopy/TableDiff.hx:159: lines 159-176
		while ($_g1 < $_g) {
			#coopy/TableDiff.hx:159: lines 159-176
			$_g1 = $_g1 + 1;
			#coopy/TableDiff.hx:159: characters 14-15
			$i = $_g1 - 1;
			#coopy/TableDiff.hx:160: characters 13-40
			$unit = ($m->data[$i] ?? null);
			#coopy/TableDiff.hx:161: characters 13-37
			if ($unit === null) {
				#coopy/TableDiff.hx:161: characters 29-37
				continue;
			}
			#coopy/TableDiff.hx:162: lines 162-168
			if ($unit->l >= 0) {
				#coopy/TableDiff.hx:163: lines 163-166
				if ($unit->l < $l) {
					#coopy/TableDiff.hx:164: characters 21-37
					$reordered = true;
					#coopy/TableDiff.hx:165: characters 21-26
					break;
				}
				#coopy/TableDiff.hx:167: characters 17-27
				$l = $unit->l;
			}
			#coopy/TableDiff.hx:169: lines 169-175
			if ($unit->r >= 0) {
				#coopy/TableDiff.hx:170: lines 170-173
				if ($unit->r < $r) {
					#coopy/TableDiff.hx:171: characters 21-37
					$reordered = true;
					#coopy/TableDiff.hx:172: characters 21-26
					break;
				}
				#coopy/TableDiff.hx:174: characters 17-27
				$r = $unit->r;
			}
		}

		#coopy/TableDiff.hx:177: characters 9-25
		return $reordered;
	}


	/**
	 * @param View $v
	 * @param mixed $str
	 * 
	 * @return string
	 */
	public function normalizeString ($v, $str) {
		#coopy/TableDiff.hx:693: characters 9-34
		if ($str === null) {
			#coopy/TableDiff.hx:693: characters 24-34
			return $str;
		}
		#coopy/TableDiff.hx:694: lines 694-696
		if (!($this->flags->ignore_whitespace || $this->flags->ignore_case)) {
			#coopy/TableDiff.hx:695: characters 13-23
			return $str;
		}
		#coopy/TableDiff.hx:697: characters 9-35
		$txt = $v->toString($str);
		#coopy/TableDiff.hx:698: lines 698-700
		if ($this->flags->ignore_whitespace) {
			#coopy/TableDiff.hx:699: characters 13-40
			$txt = trim($txt);
		}
		#coopy/TableDiff.hx:701: lines 701-703
		if ($this->flags->ignore_case) {
			#coopy/TableDiff.hx:702: characters 13-36
			$txt = strtolower($txt);
		}
		#coopy/TableDiff.hx:704: characters 9-19
		return $txt;
	}


	/**
	 * @param View $v
	 * @param mixed $d
	 * 
	 * @return string
	 */
	public function quoteForDiff ($v, $d) {
		#coopy/TableDiff.hx:139: characters 9-35
		$nil = "NULL";
		#coopy/TableDiff.hx:140: lines 140-142
		if ($v->equals($d, null)) {
			#coopy/TableDiff.hx:141: characters 13-23
			return $nil;
		}
		#coopy/TableDiff.hx:143: characters 9-42
		$str = $v->toString($d);
		#coopy/TableDiff.hx:144: characters 9-29
		$score = 0;
		#coopy/TableDiff.hx:145: lines 145-148
		$_g1 = 0;
		#coopy/TableDiff.hx:145: lines 145-148
		$_g = strlen($str);
		#coopy/TableDiff.hx:145: lines 145-148
		while ($_g1 < $_g) {
			#coopy/TableDiff.hx:145: lines 145-148
			$_g1 = $_g1 + 1;
			#coopy/TableDiff.hx:145: characters 14-15
			$i = $_g1 - 1;
			#coopy/TableDiff.hx:146: characters 13-55
			if (((($score < 0) || ($score >= strlen($str)) ? null : ord($str[$score]))) !== 95) {
				#coopy/TableDiff.hx:146: characters 50-55
				break;
			}
			#coopy/TableDiff.hx:147: characters 13-20
			$score = $score + 1;
		}

		#coopy/TableDiff.hx:149: lines 149-151
		if (HxString::substr($str, $score) === $nil) {
			#coopy/TableDiff.hx:150: characters 13-28
			$str = "_" . ($str??'null');
		}
		#coopy/TableDiff.hx:152: characters 9-19
		return $str;
	}


	/**
	 * @return void
	 */
	public function refineActivity () {
		#coopy/TableDiff.hx:680: characters 9-68
		$this->spreadContext($this->row_units, $this->flags->unchanged_context, $this->active_row);
		#coopy/TableDiff.hx:681: lines 681-682
		$this->spreadContext($this->column_units, $this->flags->unchanged_column_context, $this->active_column);
		#coopy/TableDiff.hx:683: lines 683-689
		if ($this->active_column !== null) {
			#coopy/TableDiff.hx:684: lines 684-688
			$_g1 = 0;
			#coopy/TableDiff.hx:684: lines 684-688
			$_g = $this->column_units->length;
			#coopy/TableDiff.hx:684: lines 684-688
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:684: lines 684-688
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:684: characters 18-19
				$i = $_g1 - 1;
				#coopy/TableDiff.hx:685: lines 685-687
				if (($this->active_column->arr[$i] ?? null) === 3) {
					#coopy/TableDiff.hx:686: characters 21-41
					$this->active_column[$i] = 0;
				}
			}
		}
	}


	/**
	 * @return void
	 */
	public function reset () {
		#coopy/TableDiff.hx:259: characters 9-27
		$this->has_parent = false;
		#coopy/TableDiff.hx:260: characters 9-46
		$this->rp_header = $this->ra_header = $this->rb_header = 0;
		#coopy/TableDiff.hx:261: characters 9-41
		$this->is_index_p = new IntMap();
		#coopy/TableDiff.hx:262: characters 9-41
		$this->is_index_a = new IntMap();
		#coopy/TableDiff.hx:263: characters 9-41
		$this->is_index_b = new IntMap();
		#coopy/TableDiff.hx:264: characters 9-38
		$this->row_map = new IntMap();
		#coopy/TableDiff.hx:265: characters 9-38
		$this->col_map = new IntMap();
		#coopy/TableDiff.hx:266: characters 9-32
		$this->show_rc_numbers = false;
		#coopy/TableDiff.hx:267: characters 9-25
		$this->row_moves = null;
		#coopy/TableDiff.hx:268: characters 9-25
		$this->col_moves = null;
		#coopy/TableDiff.hx:269: characters 9-58
		$this->allow_insert = $this->allow_delete = $this->allow_update = true;
		#coopy/TableDiff.hx:270: characters 9-17
		$this->sep = "";
		#coopy/TableDiff.hx:271: characters 9-26
		$this->conflict_sep = "";
		#coopy/TableDiff.hx:272: characters 9-30
		$this->top_line_done = false;
		#coopy/TableDiff.hx:273: characters 9-27
		$this->diff_found = false;
		#coopy/TableDiff.hx:274: characters 9-34
		$this->schema_diff_found = false;
		#coopy/TableDiff.hx:275: characters 9-24
		$this->row_deletes = 0;
		#coopy/TableDiff.hx:276: characters 9-24
		$this->row_inserts = 0;
		#coopy/TableDiff.hx:277: characters 9-24
		$this->row_updates = 0;
		#coopy/TableDiff.hx:278: characters 9-25
		$this->row_reorders = 0;
		#coopy/TableDiff.hx:279: characters 9-24
		$this->col_deletes = 0;
		#coopy/TableDiff.hx:280: characters 9-24
		$this->col_inserts = 0;
		#coopy/TableDiff.hx:281: characters 9-24
		$this->col_updates = 0;
		#coopy/TableDiff.hx:282: characters 9-24
		$this->col_renames = 0;
		#coopy/TableDiff.hx:283: characters 9-25
		$this->col_reorders = 0;
		#coopy/TableDiff.hx:284: characters 9-51
		$this->column_units_updated = new IntMap();
	}


	/**
	 * @return void
	 */
	public function scanActivity () {
		#coopy/TableDiff.hx:344: characters 9-38
		$this->active_row = new \Array_hx();
		#coopy/TableDiff.hx:345: characters 9-29
		$this->active_column = null;
		#coopy/TableDiff.hx:346: lines 346-351
		if (!$this->flags->show_unchanged) {
			#coopy/TableDiff.hx:347: lines 347-350
			$_g1 = 0;
			#coopy/TableDiff.hx:347: lines 347-350
			$_g = $this->row_units->length;
			#coopy/TableDiff.hx:347: lines 347-350
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:347: lines 347-350
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:347: characters 18-19
				$i = $_g1 - 1;
				#coopy/TableDiff.hx:349: characters 17-53
				$this->active_row[$this->row_units->length - 1 - $i] = 0;
			}
		}
		#coopy/TableDiff.hx:353: lines 353-363
		if (!$this->flags->show_unchanged_columns) {
			#coopy/TableDiff.hx:354: characters 13-45
			$this->active_column = new \Array_hx();
			#coopy/TableDiff.hx:355: lines 355-362
			$_g11 = 0;
			#coopy/TableDiff.hx:355: lines 355-362
			$_g2 = $this->column_units->length;
			#coopy/TableDiff.hx:355: lines 355-362
			while ($_g11 < $_g2) {
				#coopy/TableDiff.hx:355: lines 355-362
				$_g11 = $_g11 + 1;
				#coopy/TableDiff.hx:355: characters 18-19
				$i1 = $_g11 - 1;
				#coopy/TableDiff.hx:356: characters 17-33
				$v = 0;
				#coopy/TableDiff.hx:357: characters 17-51
				$unit = ($this->column_units->arr[$i1] ?? null);
				#coopy/TableDiff.hx:358: characters 17-63
				if (($unit->l >= 0) && ($this->is_index_a->data[$unit->l] ?? null)) {
					#coopy/TableDiff.hx:358: characters 58-63
					$v = 1;
				}
				#coopy/TableDiff.hx:359: characters 17-63
				if (($unit->r >= 0) && ($this->is_index_b->data[$unit->r] ?? null)) {
					#coopy/TableDiff.hx:359: characters 58-63
					$v = 1;
				}
				#coopy/TableDiff.hx:360: characters 17-63
				if (($unit->p >= 0) && ($this->is_index_p->data[$unit->p] ?? null)) {
					#coopy/TableDiff.hx:360: characters 58-63
					$v = 1;
				}
				#coopy/TableDiff.hx:361: characters 17-37
				$this->active_column[$i1] = $v;
			}

		}
	}


	/**
	 * @param Unit $unit
	 * @param Table $output
	 * @param int $at
	 * @param int $i
	 * @param int $out
	 * 
	 * @return void
	 */
	public function scanRow ($unit, $output, $at, $i, $out) {
		#coopy/TableDiff.hx:803: characters 9-39
		$row_update = false;
		#coopy/TableDiff.hx:804: lines 804-956
		$_g1 = 0;
		#coopy/TableDiff.hx:804: lines 804-956
		$_g = $this->column_units->length;
		#coopy/TableDiff.hx:804: lines 804-956
		while ($_g1 < $_g) {
			#coopy/TableDiff.hx:804: lines 804-956
			$_g1 = $_g1 + 1;
			#coopy/TableDiff.hx:804: characters 14-15
			$j = $_g1 - 1;
			#coopy/TableDiff.hx:805: characters 13-48
			$cunit = ($this->column_units->arr[$j] ?? null);
			#coopy/TableDiff.hx:806: characters 13-37
			$pp = null;
			#coopy/TableDiff.hx:807: characters 13-37
			$ll = null;
			#coopy/TableDiff.hx:808: characters 13-37
			$rr = null;
			#coopy/TableDiff.hx:809: characters 13-37
			$dd = null;
			#coopy/TableDiff.hx:810: characters 13-40
			$dd_to = null;
			#coopy/TableDiff.hx:811: characters 13-43
			$have_dd_to = false;
			#coopy/TableDiff.hx:812: characters 13-44
			$dd_to_alt = null;
			#coopy/TableDiff.hx:813: characters 13-47
			$have_dd_to_alt = false;
			#coopy/TableDiff.hx:814: characters 13-40
			$have_pp = false;
			#coopy/TableDiff.hx:815: characters 13-40
			$have_ll = false;
			#coopy/TableDiff.hx:816: characters 13-40
			$have_rr = false;
			#coopy/TableDiff.hx:817: lines 817-820
			if (($cunit->p >= 0) && ($unit->p >= 0)) {
				#coopy/TableDiff.hx:818: characters 17-47
				$pp = $this->p->getCell($cunit->p, $unit->p);
				#coopy/TableDiff.hx:819: characters 17-31
				$have_pp = true;
			}
			#coopy/TableDiff.hx:821: lines 821-824
			if (($cunit->l >= 0) && ($unit->l >= 0)) {
				#coopy/TableDiff.hx:822: characters 17-47
				$ll = $this->a->getCell($cunit->l, $unit->l);
				#coopy/TableDiff.hx:823: characters 17-31
				$have_ll = true;
			}
			#coopy/TableDiff.hx:825: lines 825-837
			if (($cunit->r >= 0) && ($unit->r >= 0)) {
				#coopy/TableDiff.hx:826: characters 17-47
				$rr = $this->b->getCell($cunit->r, $unit->r);
				#coopy/TableDiff.hx:827: characters 17-31
				$have_rr = true;
				#coopy/TableDiff.hx:828: lines 828-836
				if ((($have_pp ? $cunit->p : $cunit->l)) < 0) {
					#coopy/TableDiff.hx:829: lines 829-835
					if ($rr !== null) {
						#coopy/TableDiff.hx:830: lines 830-834
						if ($this->v->toString($rr) !== "") {
							#coopy/TableDiff.hx:831: lines 831-833
							if ($this->flags->allowUpdate()) {
								#coopy/TableDiff.hx:832: characters 33-53
								$this->have_addition = true;
							}
						}
					}
				}
			}
			#coopy/TableDiff.hx:842: lines 842-851
			if ($this->nested) {
				#coopy/TableDiff.hx:843: lines 843-847
				$ndiff = $this->checkNesting($this->v, $have_ll, $ll, $have_rr, $rr, $have_pp, $pp, $i, $j);
				#coopy/TableDiff.hx:848: characters 17-30
				$ll = ($ndiff->arr[0] ?? null);
				#coopy/TableDiff.hx:849: characters 17-30
				$rr = ($ndiff->arr[1] ?? null);
				#coopy/TableDiff.hx:850: characters 17-30
				$pp = ($ndiff->arr[2] ?? null);
			}
			#coopy/TableDiff.hx:854: lines 854-890
			if ($have_pp) {
				#coopy/TableDiff.hx:855: lines 855-874
				if (!$have_rr) {
					#coopy/TableDiff.hx:856: characters 21-28
					$dd = $pp;
				} else if ($this->isEqual($this->v, $pp, $rr)) {
					#coopy/TableDiff.hx:860: characters 25-32
					$dd = $ll;
				} else {
					#coopy/TableDiff.hx:863: characters 25-32
					$dd = $pp;
					#coopy/TableDiff.hx:864: characters 25-35
					$dd_to = $rr;
					#coopy/TableDiff.hx:865: characters 25-42
					$have_dd_to = true;
					#coopy/TableDiff.hx:867: lines 867-872
					if (!$this->isEqual($this->v, $pp, $ll)) {
						#coopy/TableDiff.hx:868: lines 868-871
						if (!$this->isEqual($this->v, $pp, $rr)) {
							#coopy/TableDiff.hx:869: characters 33-47
							$dd_to_alt = $ll;
							#coopy/TableDiff.hx:870: characters 33-54
							$have_dd_to_alt = true;
						}
					}
				}
			} else if ($have_ll) {
				#coopy/TableDiff.hx:876: lines 876-887
				if (!$have_rr) {
					#coopy/TableDiff.hx:877: characters 21-28
					$dd = $ll;
				} else if ($this->isEqual($this->v, $ll, $rr)) {
					#coopy/TableDiff.hx:880: characters 25-32
					$dd = $ll;
				} else {
					#coopy/TableDiff.hx:883: characters 25-32
					$dd = $ll;
					#coopy/TableDiff.hx:884: characters 25-35
					$dd_to = $rr;
					#coopy/TableDiff.hx:885: characters 25-42
					$have_dd_to = true;
				}
			} else {
				#coopy/TableDiff.hx:889: characters 17-24
				$dd = $rr;
			}
			#coopy/TableDiff.hx:892: characters 13-37
			$cell = $dd;
			#coopy/TableDiff.hx:893: lines 893-940
			if ($have_dd_to && $this->allow_update) {
				#coopy/TableDiff.hx:894: lines 894-897
				if (!$row_update) {
					#coopy/TableDiff.hx:895: characters 21-46
					if ($out === 0) {
						#coopy/TableDiff.hx:895: characters 33-46
						$this->row_updates++;
					}
					#coopy/TableDiff.hx:896: characters 21-38
					$row_update = true;
				}
				#coopy/TableDiff.hx:898: lines 898-900
				if ($this->active_column !== null) {
					#coopy/TableDiff.hx:899: characters 21-41
					$this->active_column[$j] = 1;
				}
				#coopy/TableDiff.hx:902: lines 902-911
				if ($this->sep === "") {
					#coopy/TableDiff.hx:903: lines 903-910
					if ($this->builder->needSeparator()) {
						#coopy/TableDiff.hx:906: characters 25-53
						$this->sep = $this->getSeparator($this->a, $this->b, "->");
						#coopy/TableDiff.hx:907: characters 25-50
						$this->builder->setSeparator($this->sep);
					} else {
						#coopy/TableDiff.hx:909: characters 25-35
						$this->sep = "->";
					}
				}
				#coopy/TableDiff.hx:912: characters 17-48
				$is_conflict = false;
				#coopy/TableDiff.hx:913: lines 913-917
				if ($have_dd_to_alt) {
					#coopy/TableDiff.hx:914: lines 914-916
					if (!$this->isEqual($this->v, $dd_to, $dd_to_alt)) {
						#coopy/TableDiff.hx:915: characters 25-43
						$is_conflict = true;
					}
				}
				#coopy/TableDiff.hx:918: lines 918-935
				if (!$is_conflict) {
					#coopy/TableDiff.hx:919: characters 21-52
					$cell = $this->builder->update($dd, $dd_to);
					#coopy/TableDiff.hx:920: lines 920-922
					if (strlen($this->sep) > strlen($this->act)) {
						#coopy/TableDiff.hx:921: characters 25-34
						$this->act = $this->sep;
					}
				} else {
					#coopy/TableDiff.hx:924: lines 924-932
					if ($this->conflict_sep === "") {
						#coopy/TableDiff.hx:925: lines 925-931
						if ($this->builder->needSeparator()) {
							#coopy/TableDiff.hx:927: characters 29-71
							$this->conflict_sep = ($this->getSeparator($this->p, $this->a, "!")??'null') . ($this->sep??'null');
							#coopy/TableDiff.hx:928: characters 29-71
							$this->builder->setConflictSeparator($this->conflict_sep);
						} else {
							#coopy/TableDiff.hx:930: characters 29-49
							$this->conflict_sep = "!->";
						}
					}
					#coopy/TableDiff.hx:933: characters 21-64
					$cell = $this->builder->conflict($dd, $dd_to_alt, $dd_to);
					#coopy/TableDiff.hx:934: characters 21-39
					$this->act = $this->conflict_sep;
				}
				#coopy/TableDiff.hx:936: lines 936-939
				if (!array_key_exists($j, $this->column_units_updated->data)) {
					#coopy/TableDiff.hx:937: characters 21-53
					$this->column_units_updated->data[$j] = true;
					#coopy/TableDiff.hx:938: characters 21-34
					$this->col_updates++;
				}
			}
			#coopy/TableDiff.hx:941: lines 941-943
			if (($this->act === "") && $this->have_addition) {
				#coopy/TableDiff.hx:942: characters 17-26
				$this->act = "+";
			}
			#coopy/TableDiff.hx:944: lines 944-950
			if ($this->act === "+++") {
				#coopy/TableDiff.hx:945: lines 945-949
				if ($have_rr) {
					#coopy/TableDiff.hx:946: lines 946-948
					if ($this->active_column !== null) {
						#coopy/TableDiff.hx:947: characters 25-45
						$this->active_column[$j] = 1;
					}
				}
			}
			#coopy/TableDiff.hx:951: lines 951-955
			if ($this->publish) {
				#coopy/TableDiff.hx:952: lines 952-954
				if (($this->active_column === null) || (($this->active_column->arr[$j] ?? null) > 0)) {
					#coopy/TableDiff.hx:953: characters 21-48
					$output->setCell($j + 1, $at, $cell);
				}
			}
		}

		#coopy/TableDiff.hx:958: lines 958-961
		if ($this->publish) {
			#coopy/TableDiff.hx:959: characters 13-53
			$output->setCell(0, $at, $this->builder->marker($this->act));
			#coopy/TableDiff.hx:960: characters 13-33
			$this->row_map->data[$at] = $unit;
		}
		#coopy/TableDiff.hx:963: lines 963-970
		if ($this->act !== "") {
			#coopy/TableDiff.hx:964: characters 13-30
			$this->diff_found = true;
			#coopy/TableDiff.hx:965: lines 965-969
			if (!$this->publish) {
				#coopy/TableDiff.hx:966: lines 966-968
				if ($this->active_row !== null) {
					#coopy/TableDiff.hx:967: characters 21-38
					$this->active_row[$i] = 1;
				}
			}
		}
	}


	/**
	 * @return void
	 */
	public function scanSchema () {
		#coopy/TableDiff.hx:408: characters 9-37
		$this->schema = new \Array_hx();
		#coopy/TableDiff.hx:409: characters 9-28
		$this->have_schema = false;
		#coopy/TableDiff.hx:410: lines 410-470
		$_g1 = 0;
		#coopy/TableDiff.hx:410: lines 410-470
		$_g = $this->column_units->length;
		#coopy/TableDiff.hx:410: lines 410-470
		while ($_g1 < $_g) {
			#coopy/TableDiff.hx:410: lines 410-470
			$_g1 = $_g1 + 1;
			#coopy/TableDiff.hx:410: characters 14-15
			$j = $_g1 - 1;
			#coopy/TableDiff.hx:411: characters 13-48
			$cunit = ($this->column_units->arr[$j] ?? null);
			#coopy/TableDiff.hx:412: characters 13-42
			$reordered = false;
			#coopy/TableDiff.hx:414: lines 414-419
			if ($this->flags->ordered) {
				#coopy/TableDiff.hx:415: lines 415-417
				if (array_key_exists($j, $this->col_moves->data)) {
					#coopy/TableDiff.hx:416: characters 21-37
					$reordered = true;
				}
				#coopy/TableDiff.hx:418: characters 17-54
				if ($reordered) {
					#coopy/TableDiff.hx:418: characters 32-54
					$this->show_rc_numbers = true;
				}
			}
			#coopy/TableDiff.hx:421: characters 13-35
			$act = "";
			#coopy/TableDiff.hx:422: lines 422-433
			if (($cunit->r >= 0) && ($cunit->lp() === -1)) {
				#coopy/TableDiff.hx:423: characters 17-35
				$this->have_schema = true;
				#coopy/TableDiff.hx:424: characters 17-28
				$act = "+++";
				#coopy/TableDiff.hx:425: lines 425-429
				if ($this->active_column !== null) {
					#coopy/TableDiff.hx:426: lines 426-428
					if ($this->allow_update) {
						#coopy/TableDiff.hx:427: characters 25-45
						$this->active_column[$j] = 1;
					}
				}
				#coopy/TableDiff.hx:430: lines 430-432
				if ($this->allow_update) {
					#coopy/TableDiff.hx:431: characters 21-34
					$this->col_inserts++;
				}
			}
			#coopy/TableDiff.hx:434: lines 434-445
			if (($cunit->r < 0) && ($cunit->lp() >= 0)) {
				#coopy/TableDiff.hx:435: characters 17-35
				$this->have_schema = true;
				#coopy/TableDiff.hx:436: characters 17-28
				$act = "---";
				#coopy/TableDiff.hx:437: lines 437-441
				if ($this->active_column !== null) {
					#coopy/TableDiff.hx:438: lines 438-440
					if ($this->allow_update) {
						#coopy/TableDiff.hx:439: characters 25-45
						$this->active_column[$j] = 1;
					}
				}
				#coopy/TableDiff.hx:442: lines 442-444
				if ($this->allow_update) {
					#coopy/TableDiff.hx:443: characters 21-34
					$this->col_deletes++;
				}
			}
			#coopy/TableDiff.hx:446: lines 446-461
			if (($cunit->r >= 0) && ($cunit->lp() >= 0)) {
				#coopy/TableDiff.hx:447: lines 447-460
				if (($this->p->get_height() >= $this->rp_header) && ($this->b->get_height() >= $this->rb_header)) {
					#coopy/TableDiff.hx:448: characters 21-72
					$pp = $this->p->getCell($cunit->lp(), $this->rp_header);
					#coopy/TableDiff.hx:449: characters 21-69
					$bb = $this->b->getCell($cunit->r, $this->rb_header);
					#coopy/TableDiff.hx:450: lines 450-459
					if (!$this->isEqual($this->v, $pp, $bb)) {
						#coopy/TableDiff.hx:451: characters 25-43
						$this->have_schema = true;
						#coopy/TableDiff.hx:452: characters 25-34
						$act = "(";
						#coopy/TableDiff.hx:453: characters 25-46
						$act = ($act??'null') . ($this->v->toString($pp)??'null');
						#coopy/TableDiff.hx:454: characters 25-35
						$act = ($act??'null') . ")";
						#coopy/TableDiff.hx:455: lines 455-458
						if ($this->active_column !== null) {
							#coopy/TableDiff.hx:456: characters 29-49
							$this->active_column[$j] = 1;
							#coopy/TableDiff.hx:457: characters 29-42
							$this->col_renames++;
						}
					}
				}
			}
			#coopy/TableDiff.hx:462: lines 462-467
			if ($reordered) {
				#coopy/TableDiff.hx:463: characters 17-32
				$act = ":" . ($act??'null');
				#coopy/TableDiff.hx:464: characters 17-35
				$this->have_schema = true;
				#coopy/TableDiff.hx:465: characters 17-62
				if ($this->active_column !== null) {
					#coopy/TableDiff.hx:465: characters 42-62
					$this->active_column = null;
				}
				#coopy/TableDiff.hx:466: characters 17-31
				$this->col_reorders++;
			}
			#coopy/TableDiff.hx:469: characters 13-29
			$_this = $this->schema;
			#coopy/TableDiff.hx:469: characters 13-29
			$_this->arr[$_this->length] = $act;
			#coopy/TableDiff.hx:469: characters 13-29
			++$_this->length;

		}

	}


	/**
	 * @param CellBuilder $builder
	 * 
	 * @return void
	 */
	public function setCellBuilder ($builder) {
		#coopy/TableDiff.hx:104: characters 9-31
		$this->builder = $builder;
	}


	/**
	 * @param StringMap $ignore
	 * @param IntMap $idx_ignore
	 * @param Table $tab
	 * @param int $r_header
	 * 
	 * @return void
	 */
	public function setIgnore ($ignore, $idx_ignore, $tab, $r_header) {
		#coopy/TableDiff.hx:234: characters 9-35
		$v = $tab->getCellView();
		#coopy/TableDiff.hx:235: lines 235-241
		if ($tab->get_height() >= $r_header) {
			#coopy/TableDiff.hx:236: lines 236-240
			$_g1 = 0;
			#coopy/TableDiff.hx:236: lines 236-240
			$_g = $tab->get_width();
			#coopy/TableDiff.hx:236: lines 236-240
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:236: lines 236-240
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:236: characters 18-19
				$i = $_g1 - 1;
				#coopy/TableDiff.hx:237: characters 17-64
				$name = $v->toString($tab->getCell($i, $r_header));
				#coopy/TableDiff.hx:238: characters 17-51
				if (!array_key_exists($name, $ignore->data)) {
					#coopy/TableDiff.hx:238: characters 43-51
					continue;
				}
				#coopy/TableDiff.hx:239: characters 17-39
				$idx_ignore->data[$i] = true;
			}
		}
	}


	/**
	 * @return void
	 */
	public function setupColumns () {
		#coopy/TableDiff.hx:368: characters 9-60
		$column_order = $this->align->meta->toOrder();
		#coopy/TableDiff.hx:369: characters 9-46
		$this->column_units = $column_order->getList();
		#coopy/TableDiff.hx:371: characters 9-48
		$ignore = $this->flags->getIgnoredColumns();
		#coopy/TableDiff.hx:372: lines 372-389
		if ($ignore !== null) {
			#coopy/TableDiff.hx:373: characters 13-48
			$p_ignore = new IntMap();
			#coopy/TableDiff.hx:374: characters 13-48
			$a_ignore = new IntMap();
			#coopy/TableDiff.hx:375: characters 13-48
			$b_ignore = new IntMap();
			#coopy/TableDiff.hx:376: characters 13-51
			$this->setIgnore($ignore, $p_ignore, $this->p, $this->rp_header);
			#coopy/TableDiff.hx:377: characters 13-51
			$this->setIgnore($ignore, $a_ignore, $this->a, $this->ra_header);
			#coopy/TableDiff.hx:378: characters 13-51
			$this->setIgnore($ignore, $b_ignore, $this->b, $this->rb_header);
			#coopy/TableDiff.hx:380: characters 13-51
			$ncolumn_units = new \Array_hx();
			#coopy/TableDiff.hx:381: lines 381-387
			$_g1 = 0;
			#coopy/TableDiff.hx:381: lines 381-387
			$_g = $this->column_units->length;
			#coopy/TableDiff.hx:381: lines 381-387
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:381: lines 381-387
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:381: characters 18-19
				$j = $_g1 - 1;
				#coopy/TableDiff.hx:382: characters 17-52
				$cunit = ($this->column_units->arr[$j] ?? null);
				#coopy/TableDiff.hx:383: lines 383-385
				if (array_key_exists($cunit->p, $p_ignore->data) || array_key_exists($cunit->l, $a_ignore->data) || array_key_exists($cunit->r, $b_ignore->data)) {
					#coopy/TableDiff.hx:385: characters 47-55
					continue;
				}
				#coopy/TableDiff.hx:386: characters 17-42
				$ncolumn_units->arr[$ncolumn_units->length] = $cunit;
				#coopy/TableDiff.hx:386: characters 17-42
				++$ncolumn_units->length;

			}

			#coopy/TableDiff.hx:388: characters 13-41
			$this->column_units = $ncolumn_units;
		}
	}


	/**
	 * @return void
	 */
	public function setupMoves () {
		#coopy/TableDiff.hx:393: lines 393-404
		if ($this->flags->ordered) {
			#coopy/TableDiff.hx:394: characters 13-43
			$this->row_moves = new IntMap();
			#coopy/TableDiff.hx:395: characters 13-65
			$moves = Mover::moveUnits($this->row_units);
			#coopy/TableDiff.hx:396: lines 396-398
			$_g1 = 0;
			#coopy/TableDiff.hx:396: lines 396-398
			$_g = $moves->length;
			#coopy/TableDiff.hx:396: lines 396-398
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:396: lines 396-398
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:396: characters 18-19
				$i = $_g1 - 1;
				#coopy/TableDiff.hx:397: characters 17-40
				$this->row_moves->data[$moves[$i]] = $i;
			}

			#coopy/TableDiff.hx:399: characters 13-43
			$this->col_moves = new IntMap();
			#coopy/TableDiff.hx:400: characters 13-50
			$moves = Mover::moveUnits($this->column_units);
			#coopy/TableDiff.hx:401: lines 401-403
			$_g11 = 0;
			#coopy/TableDiff.hx:401: lines 401-403
			$_g2 = $moves->length;
			#coopy/TableDiff.hx:401: lines 401-403
			while ($_g11 < $_g2) {
				#coopy/TableDiff.hx:401: lines 401-403
				$_g11 = $_g11 + 1;
				#coopy/TableDiff.hx:401: characters 18-19
				$i1 = $_g11 - 1;
				#coopy/TableDiff.hx:402: characters 17-40
				$this->col_moves->data[$moves[$i1]] = $i1;
			}

		}
	}


	/**
	 * @return void
	 */
	public function setupTables () {
		#coopy/TableDiff.hx:288: characters 9-32
		$this->order = $this->align->toOrder();
		#coopy/TableDiff.hx:289: characters 9-36
		$this->row_units = $this->order->getList();
		#coopy/TableDiff.hx:290: characters 9-47
		$this->has_parent = $this->align->reference !== null;
		#coopy/TableDiff.hx:291: lines 291-323
		if ($this->has_parent) {
			#coopy/TableDiff.hx:292: characters 13-34
			$this->p = $this->align->getSource();
			#coopy/TableDiff.hx:293: characters 13-44
			$this->a = $this->align->reference->getTarget();
			#coopy/TableDiff.hx:294: characters 13-34
			$this->b = $this->align->getTarget();
			#coopy/TableDiff.hx:295: characters 13-63
			$this->rp_header = $this->align->reference->meta->getSourceHeader();
			#coopy/TableDiff.hx:296: characters 13-63
			$this->ra_header = $this->align->reference->meta->getTargetHeader();
			#coopy/TableDiff.hx:297: characters 13-53
			$this->rb_header = $this->align->meta->getTargetHeader();
			#coopy/TableDiff.hx:298: lines 298-303
			if ($this->align->getIndexColumns() !== null) {
				#coopy/TableDiff.hx:299: lines 299-302
				$_g = 0;
				#coopy/TableDiff.hx:299: lines 299-302
				$_g1 = $this->align->getIndexColumns();
				#coopy/TableDiff.hx:299: lines 299-302
				while ($_g < $_g1->length) {
					#coopy/TableDiff.hx:299: characters 22-25
					$p2b = ($_g1->arr[$_g] ?? null);
					#coopy/TableDiff.hx:299: lines 299-302
					$_g = $_g + 1;
					#coopy/TableDiff.hx:300: characters 21-61
					if ($p2b->l >= 0) {
						#coopy/TableDiff.hx:300: characters 35-61
						$this->is_index_p->data[$p2b->l] = true;
					}
					#coopy/TableDiff.hx:301: characters 21-61
					if ($p2b->r >= 0) {
						#coopy/TableDiff.hx:301: characters 35-61
						$this->is_index_b->data[$p2b->r] = true;
					}
				}
			}
			#coopy/TableDiff.hx:304: lines 304-309
			if ($this->align->reference->getIndexColumns() !== null) {
				#coopy/TableDiff.hx:305: lines 305-308
				$_g2 = 0;
				#coopy/TableDiff.hx:305: lines 305-308
				$_g11 = $this->align->reference->getIndexColumns();
				#coopy/TableDiff.hx:305: lines 305-308
				while ($_g2 < $_g11->length) {
					#coopy/TableDiff.hx:305: characters 22-25
					$p2a = ($_g11->arr[$_g2] ?? null);
					#coopy/TableDiff.hx:305: lines 305-308
					$_g2 = $_g2 + 1;
					#coopy/TableDiff.hx:306: characters 21-61
					if ($p2a->l >= 0) {
						#coopy/TableDiff.hx:306: characters 35-61
						$this->is_index_p->data[$p2a->l] = true;
					}
					#coopy/TableDiff.hx:307: characters 21-61
					if ($p2a->r >= 0) {
						#coopy/TableDiff.hx:307: characters 35-61
						$this->is_index_a->data[$p2a->r] = true;
					}
				}
			}
		} else {
			#coopy/TableDiff.hx:311: characters 13-34
			$this->a = $this->align->getSource();
			#coopy/TableDiff.hx:312: characters 13-34
			$this->b = $this->align->getTarget();
			#coopy/TableDiff.hx:313: characters 13-18
			$this->p = $this->a;
			#coopy/TableDiff.hx:314: characters 13-53
			$this->ra_header = $this->align->meta->getSourceHeader();
			#coopy/TableDiff.hx:315: characters 13-34
			$this->rp_header = $this->ra_header;
			#coopy/TableDiff.hx:316: characters 13-53
			$this->rb_header = $this->align->meta->getTargetHeader();
			#coopy/TableDiff.hx:317: lines 317-322
			if ($this->align->getIndexColumns() !== null) {
				#coopy/TableDiff.hx:318: lines 318-321
				$_g3 = 0;
				#coopy/TableDiff.hx:318: lines 318-321
				$_g12 = $this->align->getIndexColumns();
				#coopy/TableDiff.hx:318: lines 318-321
				while ($_g3 < $_g12->length) {
					#coopy/TableDiff.hx:318: characters 22-25
					$a2b = ($_g12->arr[$_g3] ?? null);
					#coopy/TableDiff.hx:318: lines 318-321
					$_g3 = $_g3 + 1;
					#coopy/TableDiff.hx:319: characters 21-61
					if ($a2b->l >= 0) {
						#coopy/TableDiff.hx:319: characters 35-61
						$this->is_index_a->data[$a2b->l] = true;
					}
					#coopy/TableDiff.hx:320: characters 21-61
					if ($a2b->r >= 0) {
						#coopy/TableDiff.hx:320: characters 35-61
						$this->is_index_b->data[$a2b->r] = true;
					}
				}
			}
		}
		#coopy/TableDiff.hx:325: characters 9-43
		$this->allow_insert = $this->flags->allowInsert();
		#coopy/TableDiff.hx:326: characters 9-43
		$this->allow_delete = $this->flags->allowDelete();
		#coopy/TableDiff.hx:327: characters 9-43
		$this->allow_update = $this->flags->allowUpdate();
		#coopy/TableDiff.hx:329: characters 9-24
		$common = $this->a;
		#coopy/TableDiff.hx:330: characters 9-37
		if ($common === null) {
			#coopy/TableDiff.hx:330: characters 27-37
			$common = $this->b;
		}
		#coopy/TableDiff.hx:331: characters 9-37
		if ($common === null) {
			#coopy/TableDiff.hx:331: characters 27-37
			$common = $this->p;
		}
		#coopy/TableDiff.hx:332: characters 9-33
		$this->v = $common->getCellView();
		#coopy/TableDiff.hx:333: characters 9-27
		$this->builder->setView($this->v);
		#coopy/TableDiff.hx:335: characters 9-23
		$this->nested = false;
		#coopy/TableDiff.hx:336: characters 9-37
		$meta = $common->getMeta();
		#coopy/TableDiff.hx:337: lines 337-339
		if ($meta !== null) {
			#coopy/TableDiff.hx:338: characters 13-37
			$this->nested = $meta->isNested();
		}
		#coopy/TableDiff.hx:340: characters 9-32
		$this->nesting_present = false;
	}


	/**
	 * @param \Array_hx $units
	 * @param int $del
	 * @param \Array_hx $active
	 * 
	 * @return void
	 */
	public function spreadContext ($units, $del, $active) {
		#coopy/TableDiff.hx:184: lines 184-227
		if (($del > 0) && ($active !== null)) {
			#coopy/TableDiff.hx:186: characters 13-37
			$mark = -$del - 1;
			#coopy/TableDiff.hx:187: characters 13-33
			$skips = 0;
			#coopy/TableDiff.hx:188: lines 188-204
			$_g1 = 0;
			#coopy/TableDiff.hx:188: lines 188-204
			$_g = $units->length;
			#coopy/TableDiff.hx:188: lines 188-204
			while ($_g1 < $_g) {
				#coopy/TableDiff.hx:188: lines 188-204
				$_g1 = $_g1 + 1;
				#coopy/TableDiff.hx:188: characters 18-19
				$i = $_g1 - 1;
				#coopy/TableDiff.hx:189: lines 189-193
				if (($active->arr[$i] ?? null) === -3) {
					#coopy/TableDiff.hx:191: characters 21-28
					$skips = $skips + 1;
					#coopy/TableDiff.hx:192: characters 21-29
					continue;
				}
				#coopy/TableDiff.hx:194: lines 194-203
				if ((($active->arr[$i] ?? null) === 0) || (($active->arr[$i] ?? null) === 3)) {
					#coopy/TableDiff.hx:195: lines 195-199
					if (($i - $mark) <= ($del + $skips)) {
						#coopy/TableDiff.hx:196: characters 25-38
						$active[$i] = 2;
					} else if (($i - $mark) === ($del + 1 + $skips)) {
						#coopy/TableDiff.hx:198: characters 25-38
						$active[$i] = 3;
					}
				} else if (($active->arr[$i] ?? null) === 1) {
					#coopy/TableDiff.hx:201: characters 21-29
					$mark = $i;
					#coopy/TableDiff.hx:202: characters 21-30
					$skips = 0;
				}
			}

			#coopy/TableDiff.hx:207: characters 13-42
			$mark = $units->length + $del + 1;
			#coopy/TableDiff.hx:208: characters 13-22
			$skips = 0;
			#coopy/TableDiff.hx:209: lines 209-226
			$_g11 = 0;
			#coopy/TableDiff.hx:209: lines 209-226
			$_g2 = $units->length;
			#coopy/TableDiff.hx:209: lines 209-226
			while ($_g11 < $_g2) {
				#coopy/TableDiff.hx:209: lines 209-226
				$_g11 = $_g11 + 1;
				#coopy/TableDiff.hx:209: characters 18-19
				$j = $_g11 - 1;
				#coopy/TableDiff.hx:210: characters 17-48
				$i1 = $units->length - 1 - $j;
				#coopy/TableDiff.hx:211: lines 211-215
				if (($active->arr[$i1] ?? null) === -3) {
					#coopy/TableDiff.hx:213: characters 21-28
					$skips = $skips + 1;
					#coopy/TableDiff.hx:214: characters 21-29
					continue;
				}
				#coopy/TableDiff.hx:216: lines 216-225
				if ((($active->arr[$i1] ?? null) === 0) || (($active->arr[$i1] ?? null) === 3)) {
					#coopy/TableDiff.hx:217: lines 217-221
					if (($mark - $i1) <= ($del + $skips)) {
						#coopy/TableDiff.hx:218: characters 25-38
						$active[$i1] = 2;
					} else if (($mark - $i1) === ($del + 1 + $skips)) {
						#coopy/TableDiff.hx:220: characters 25-38
						$active[$i1] = 3;
					}
				} else if (($active->arr[$i1] ?? null) === 1) {
					#coopy/TableDiff.hx:223: characters 21-29
					$mark = $i1;
					#coopy/TableDiff.hx:224: characters 21-30
					$skips = 0;
				}
			}

		}
	}
}


Boot::registerClass(TableDiff::class, 'coopy.TableDiff');
